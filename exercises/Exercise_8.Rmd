---
title: "Exercise 8"
output: learnr::tutorial
runtime: shiny_prerendered
---

```{r setup, include=FALSE}
library(learnr)
library(MASS)
library(tidyverse)
library(broom)
knitr::opts_chunk$set(echo = FALSE)

checker <- function(label,user_code,solution_code,check_code,envir_result,evaluate_result,envir_prep,...){
  
  envir_result
  out <- list(message = sample(c("Good Job!",
                                 "Well done!",
                                 "Great stuff!",
                                 "That is correct!",
                                 "Correct! You are really good at this."),1), correct = TRUE, location = "append")
  
#Question 1
if(label == "question_1"){
	if(!exists("custom_function")){
		out <- list(message = "There is no custom function saved as `custom_function`. Make sure to save the custom function as this object.", correct = FALSE, location = "append")
	} else {
		if(custom_function(51) != 53){
			out <- list(message = "The custom function does not appear to give the desired output. Fix the code to so that the function adds 2 to any numeric input.", correct = FALSE, location = "append")
		}
	}
}

#Question 2
if(label == "question_2"){
	if(!exists("multiply")){
		out <- list(message = "There is no custom function saved as `multiply`. Make sure to save the custom function as this object.", correct = FALSE, location = "append")
	} else {
		if(multiply(2,53) != 2*53){
			out <- list(message = "The custom function does not appear to give the desired output. Make sure there are no errors in your code so that the multiply function accepts two arguments, and return the product of those arguments.", correct = FALSE, location = "append")
		}
	}
}

#Question 3
if(label == "question_3"){
	if(!exists("center")){
		out <- list(message = "There is no custom function saved as `center`. Make sure to save the custom function as this object.", correct = FALSE, location = "append")
	} else {
		if(class(center) != "function"){
			out <- list(message = "The object saved as `center` is not a function. Make sure to save the custom function as this object.", correct = FALSE, location = "append")
		} else {
			if(center(c(12,23,34,45,56,67,78,89,90)) != (c(12,23,34,45,56,67,78,89,90) - mean(c(12,23,34,45,56,67,78,89,90)))){
				out <- list(message = "The custom function does not appear to give the desired output. Make sure there are no errors in your code so that the `center` function accepts a numeric vector, and return the centered values of that numeric vector.", correct = FALSE, location = "append")
			}
		}	
	}
}

if(label == "question_4"){

correct_exercise.data <- data.frame(ID = 1:40,
	var1 = c(131,100,76,100,103,107,98,104,116,98,79,88,116,111,108,93,86,130,83,93,81,85,104,73,113,102,89,96,100,102,89,105,88,142,116,95,96,109,106,101),
	var2 = c(46,42,48,49,45,50,46,55,59,49,45,43,56,48,47,41,54,47,49,48,51,48,41,47,47,50,36,56,47,45,56,41,50,36,57,47,58,40,51,58))
	
correct_exercise.data_centered <- mutate(correct_exercise.data,
                                 c.var1 = center(var1),
                                 c.var2 = center(var2))

	if(!exists("center")){
		out <- list(message = "There is no custom function saved as `center`. Make sure to save the custom function as this object.", correct = FALSE, location = "append")
	} else {
		if(class(center) != "function"){
			out <- list(message = "The object saved as `center` is not a function. Make sure to save the custom function as this object.", correct = FALSE, location = "append")
		} else {
			if(center(c(12,23,34,45,56,67,78,89,90)) != (c(12,23,34,45,56,67,78,89,90) - mean(c(12,23,34,45,56,67,78,89,90)))){
				out <- list(message = "The custom function does not appear to give the desired output. Make sure there are no errors in your code so that the 'center' function accepts a numeric vector, and return a numeric vector with the centered values.", correct = FALSE, location = "append")
			} else {
				if(!exists("exercise.data")){
					out <- list(message = "The data.frame `exercise.data` appears to have been altered. Do not alter this data.frame. Click the 'Start Over' button if necessary.", correct = FALSE, location = "append")
				} else {
					if(!identical(exercise.data,correct_exercise.data)){
						out <- list(message = "The data.frame `exercise.data` appears to have been altered. Do not alter this data.frame. Click the 'Start Over' button if necessary.", correct = FALSE, location = "append")
					} else {
						if(!exists("exercise.data_centered")){
							out <- list(message = "The data.frame `exercise.data_centered` does not exist. Remember to save the answer as this object.", correct = FALSE, location = "append")
						} else {
							if(!("c.var1" %in% colnames(exercise.data_centered)) | !("c.var2" %in% colnames(exercise.data_centered))){
								out <- list(message = "A variable named 'c.var1' or 'c.var2' is missing from the data.frame called `exercise.data_centered`. Make sure to name the newly centered variables as these.", correct = FALSE, location = "append")
							} else {
								if(!identical(exercise.data_centered,correct_exercise.data_centered)){
								out <- list(message = "The data.frame `exercise.data_centered` does not match the correct answer. Check there are no errors in the code and try again.", correct = FALSE, location = "append")
								}
							}
						}			
					}
				}
			}
		}	
	}
}

#Question 5    
if(label == "question_5"){
	if(!exists("sim.data")){
		out <- list(message = "There is no object saved as `sim.data`. Make sure to save the simulated data.frame as this object.", correct = FALSE, location = "append")
	} else {
		if(!is.data.frame(sim.data)){
			out <- list(message = "The object `sim.data` does not appear to be a data.frame. Make sure to save the simulated data.frame as this object.", correct = FALSE, location = "append")
		} else {
			if(!("var1" %in% colnames(sim.data)) | !("var2" %in% colnames(sim.data))){
				out <- list(message = "The object `sim.data` is missing variables either called 'var1' or 'var2'. Make sure to call the simulated variables by these names.", correct = FALSE, location = "append")
			} else {
				if(nrow(sim.data) != 40){
					out <- list(message = "The simulated data.frame saved as `sim.data` does not have 40 participants. Make sure the data has only 40 participants.", correct = FALSE, location = "append")
				} else {
					mv1 <- mean(sim.data$var1)
					mv2 <- mean(sim.data$var2)
					sv1 <- sd(sim.data$var1)
					sv2 <- sd(sim.data$var2)
					if(!(mv1 > 95 & mv1 < 105) | !(sv1 > 10 & sv1 < 20)){
						out <- list(message = "The characteristics of the simulated variable 'var1' does not appear to match the requirment of having a mean of 100 and a standard deviation of 15. Check there are no errors in the code. If you believe your code is correct, the simulated data may have fallen out of the acceptable ranges by chance. If you believe this to be the case, submit your answer again.", correct = FALSE, location = "append")
					} else {
						if(!(mv2 > 95 & mv2 < 105) | !(sv2 > 10 & sv2 < 20)){
							out <- list(message = "The characteristics of the simulated variable 'var2' does not appear to match the requirment of having a mean of 100 and a standard deviation of 15. Check there are no errors in the code. If you believe your code is correct, the simulated data may have fallen out of the acceptable ranges by chance. If you believe this to be the case, submit your answer again.", correct = FALSE, location = "append")
						}
					}
				}
			}
		}
	}
}

#Question 6
if(label == "question_6"){
	if(!exists("simulate_data")){
		out <- list(message = "There is no object saved as `simulate_data`. Make sure to save the custom function as this object.", correct = FALSE, location = "append")
	} else {
		if(class(simulate_data) != "function"){
			out <- list(message = "The object `simulate_data` does not appear to be a function. Make sure to save the custom function as this object.", correct = FALSE, location = "append")
		} else {
			
			test.data <- simulate_data(153)
			
			if(!("var1" %in% colnames(test.data)) | !("var2" %in% colnames(test.data))){
				out <- list(message = "The function `simulate_data()` does not appear to create a data.frame with the correct characteristics. It produces a data.frame that is missing variables either called 'var1' or 'var2'.", correct = FALSE, location = "append")
			} else {
				if(nrow(test.data) != 153){
					out <- list(message = "The simulated data.frame from the function `simulate_data()` does not appear to match what is specified in an argument. Edit the function so that the first argument specifies the sample size of the simulated data.", correct = FALSE, location = "append")
				} else {
					mv1 <- mean(test.data$var1)
					mv2 <- mean(test.data$var2)
					sv1 <- sd(test.data$var1)
					sv2 <- sd(test.data$var2)
					if(!(mv1 > 95 & mv1 < 105) | !(sv1 > 10 & sv1 < 20)){
						out <- list(message = "The characteristics of the simulated variable 'var1' resulting from the function `simulate_data()` does not appear to match the requirment of having a mean of 100 and a standard deviation of 15. Check there are no errors in the code. If you believe your code is correct, the simulated data may have fallen out of the acceptable ranges by chance. If you believe this to be the case, submit your answer again.", correct = FALSE, location = "append")
					} else {
						if(!(mv2 > 95 & mv2 < 105) | !(sv2 > 10 & sv2 < 20)){
							out <- list(message = "The characteristics of the simulated variable 'var2' resulting from the function `simulate_data()` does not appear to match the requirment of having a mean of 100 and a standard deviation of 15. Check there are no errors in the code. If you believe your code is correct, the simulated data may have fallen out of the acceptable ranges by chance. If you believe this to be the case, submit your answer again.", correct = FALSE, location = "append")
						}
					}
				}
			}
		}
	}
}
        
return(out)
}

tutorial_options(exercise.checker = checker)
```

## Introduction

This is the first of the weekly exercises. These exercises are designed to reinforce content taught each week. Typically, they consist of quiz questions and R exercises that require you to enter code into a box. These exercises are split into beginner and advance sections. It is expected that students can complete the beginner sections of each weekly exercise, with the advanced sections designed for students who want an extra challenge or learn additional functions in R.If you are struggling, each exercise comes with a number of hints that may be helpful.

## Basic Exercises

### Question 1

The custom function below is meant to add 2 to any numeric input; however, currently the function doesn't work. Edit the code to fix the function.

```{r question_1-setup}

```

```{r question_1, exercise=TRUE,exercise.lines = 6}
custom_function <- function(numeric_input){
  output <- numeric_input + 2
}
```

```{r question_1-hint-1}
Whenever you create a custom function, everything within the curly brackets is in a separate working environment.
```

```{r question_1-hint-2}
R needs to be told what to return from a custom function by using the `return()` function. To check how your function is performing, try running it and see if you get the intended effect.

Next hint will show the solution...
```

```{r question_1-solution}
custom_function <- function(numeric_input){
  output <- numeric_input + 2
  return(output)
}
#Add the `return()` function.
```

```{r question_1-check}
checker()
```

### Question 2

Create a function that takes two numeric inputs, and returns the multiplication of those two numbers. Save this custom function as the object `multiply()`.

```{r question_2-setup}

```

```{r question_2, exercise=TRUE,exercise.lines = 6}
multiply <- 
```

```{r question_2-hint-1}
Specify the arguments necessary for your custom function within the `function()` command.
```

```{r question_2-hint-2}
Remember to include what you want your function to do within curly brackets.

Next hint will show the solution...
```

```{r question_2-solution}
#Example Answer:
multiply <- function(number1,number2){
  output <- number1*number2
  return(output)
}
```

```{r question_2-check}
checker()
```

### Question 3

Below is code that centers a vector of numeric values. Put this code within a custom function named `center` so that you can easily center any vector of numeric values.

```{r question_3, exercise=TRUE,exercise.lines = 10}
numeric_vector <- c(12,23,34,45,56,67,78,89,90)
numeric_mean <- mean(numeric_vector,na.rm = TRUE)
numeric_center <- numeric_vector - numeric_mean

center <- numeric_vector
```

```{r question_3-hint-1}
Create a custom function by using the `function()` command.
```

```{r question_3-hint-2}
Remember to include what you want your function to do within curly brackets.

Next hint will show the solution...
```

```{r question_3-solution}
#Example Answer:
center <- function(numeric_vector){
  numeric_mean <- mean(numeric_vector,na.rm = TRUE)
  numeric_center <- numeric_vector - numeric_mean
  return(numeric_center)
}
```

```{r question_3-check}
checker()
```

### Question 4

Use the `center()` function created in Question 3 to center the variables 'var1' and 'var2' in the data.frame `exercise.data` below. Save the new data.frame as `exercise.data_centered` and the new variables as 'c.var1' and 'c.var2' respectively.

```{r question_4-setup}
exercise.data <- data.frame(ID = 1:40,
	var1 = c(131,100,76,100,103,107,98,104,116,98,79,88,116,111,108,93,86,130,83,93,81,85,104,73,113,102,89,96,100,102,89,105,88,142,116,95,96,109,106,101),
	var2 = c(46,42,48,49,45,50,46,55,59,49,45,43,56,48,47,41,54,47,49,48,51,48,41,47,47,50,36,56,47,45,56,41,50,36,57,47,58,40,51,58))
```

```{r question_4, exercise=TRUE,exercise.lines = 15}
center <- function(numeric_vector){
  numeric_mean <- mean(numeric_vector,na.rm = TRUE)
  numeric_center <- numeric_vector - numeric_mean
  return(numeric_center)
}

#exercise.data

exercise.data_centered <- 
```

```{r question_4-hint-1}
Use the `mutate()` function from the tidyverse package to manipulate a variable in a data.frame. You can use functions within the `mutate()` function.
```

```{r question_4-hint-2}
Edit the code below to get the correct answer:
  
exercise.data_centered <- mutate(exercise.data,
                                 c.var1 = ,
                                 c.var2 = )

Next hint will show the solution...
```

```{r question_4-solution}
#Example Answer:
center <- function(numeric_vector){
  numeric_mean <- mean(numeric_vector,na.rm = TRUE)
  numeric_center <- numeric_vector - numeric_mean
  return(numeric_center)
}

exercise.data_centered <- mutate(exercise.data,
                                 c.var1 = center(var1),
                                 c.var2 = center(var2))
```

```{r question_4-check}
checker()
```

### Question 5

Create a simulated data.frame with 40 participants and two, random continuous variables with a mean of 100 and a standard deviation of 15. Save the data.frame as `sim.data` and name the two variables `var1` and `var2`.

```{r question_5-setup}

```

```{r question_5, exercise=TRUE,exercise.lines = 7}

sim.data <- 

```

```{r question_5-hint-1}
Use the `rnorm()` function to create a random normal distribution. Type `help(rnorm)` into the console if you need help with how this function works.
```

```{r question_5-hint-2}
Edit the code below to get the correct answer:
  
sim.data <- data.frame(
  var1 = ,
  var2 = 
)

Next hint will show the solution...
```

```{r question_5-solution}
#Example Answer:
sim.data <- data.frame(
  var1 = rnorm(40, mean = 100,sd = 15),
  var2 = rnorm(40, mean = 100,sd = 15)
)
```

```{r question_5-check}
checker()
```

### Question 6

Adapt the code from Question 5 to create a function that simulates data a data.frame with two continuous variables. Name this function `simulate_data`. Create the function so that it accepts one argument, which specifies the sample size of the simulated data.frame.

```{r question_6-setup}

```

```{r question_6, exercise=TRUE,exercise.lines = 15}
sim.data <- data.frame(
  var1 = rnorm(40, mean = 100,sd = 15),
  var2 = rnorm(40, mean = 100,sd = 15)
)

simulate_data <- function(){
  
}

```

```{r question_6-hint-1}
Remember to include what you want your function to do within curly brackets.
```

```{r question_6-hint-2}
Arguments you want your function to have goes within the brackets when using the `function()` command.

Next hint will show the solution...
```

```{r question_6-solution}
#Example Answer:
simulate_data <- function(N){
  sim.data <- data.frame(
  var1 = rnorm(N, mean = 100,sd = 15),
  var2 = rnorm(N, mean = 100,sd = 15)
  )
  return(sim.data)
}
```

```{r question_6-check}
checker()
```

### Question 7

The code below creates a function that simulates a data.frame with 40 participants and two continuous variables with a correlation of r = .15, conducts a correlation between the two, then returns a p-value. Use the `replicate()` function to determine the power this analysis has to detect an effect of r > .15 or greater. Note, you don't need to understand exactly what the code within the simulate_data function does. As long as you get the gist of the function you should be able to complete this question.

```{r question_7-setup}

```

```{r question_7, exercise=TRUE,exercise.lines = 15}
simulate_data <- function(){
  sim.data <- mvrnorm(40,mu = c(0,0),Sigma = matrix(c(1,.15,.15,1),ncol = 2,nrow = 2)) %>%
    as.data.frame()
  colnames(sim.data) <- c("var1","var2")
  correlation <- cor.test(~ var1 + var2,sim.data) %>% tidy()
  p.value <- pull(correlation,p.value)
  return(p.value)
}



```

```{r question_7-hint-1}
The replicate function repeats a specified function a specified number of times, and returns the output from each of the repititons in a vector (usually).
```

```{r question_7-hint-2}
Power is the chance of finding a significant effect if it is there. Given we know that there is an effect of r = .15 in the simulated data.frame, the proportion of times a significant effect is found (i.e., the p.value is less than .05) is the power.

Next hint will show the solution...
```

```{r question_7-solution}
#Example Answer:
simulate_data <- function(){
  sim.data <- mvrnorm(40,mu = c(0,0),Sigma = matrix(c(1,.15,.15,1),ncol = 2,nrow = 2)) %>%
    as.data.frame()
  colnames(sim.data) <- c("var1","var2")
  correlation <- cor.test(~ var1 + var2,sim.data) %>% tidy()
  p.value <- pull(correlation,p.value)
  return(p.value)
}

p.values <- replicate(1000,simulate_data())
power <- mean(p.values < .05)
power
```

```{r question_7-quiz}
quiz(question("The power to detect a correlation of r = .15 with a sample size of 40 is closest to:",
     answer("0%"),
     answer("15%",correct = TRUE),
     answer ("50%"),
     answer("80%"),
     answer("100%"),allow_retry = TRUE))
```

### Question 8

Adjust the code from Question 7 to determine the appropriate sample size to detect a correlation of r = .15 with 80% power.

```{r question_8-setup}

```

```{r question_8, exercise=TRUE,exercise.lines = 15}
simulate_data <- function(){
  sim.data <- mvrnorm(40,mu = c(0,0),Sigma = matrix(c(1,.15,.15,1),ncol = 2,nrow = 2)) %>%
    as.data.frame()
  colnames(sim.data) <- c("var1","var2")
  correlation <- cor.test(~ var1 + var2,sim.data) %>% tidy()
  p.value <- pull(correlation,p.value)
  return(p.value)
}

p.values <- replicate(1000,simulate_data())
power <- mean(p.values < .05)
power
```

```{r question_8-hint-1}
First, you will need to adjust the custom function so that the simulated data.frame can vary according to sample size. This can be done by adding an argument... (Currently the `simulated_data` function creates a data.frame with 40 participants).
```

```{r question_8-hint-2}
Once you have a function where you can adjust the sample size, you will want to run the function multiple times at different sample sizes to determine the proportion of times a significant effect is found...

Next hint will show the solution...
```

```{r question_8-solution}
#Example Answer:
simulate_data <- function(N){
  sim.data <- mvrnorm(N,mu = c(0,0),Sigma = matrix(c(1,.15,.15,1),ncol = 2,nrow = 2)) %>%
    as.data.frame()
  colnames(sim.data) <- c("var1","var2")
  correlation <- cor.test(~ var1 + var2,sim.data) %>% tidy()
  p.value <- pull(correlation,p.value)
  return(p.value)
}

power.grid <- data.frame(candidate_n = rep(seq(50,380,by = 30),each = 1000)) %>%
  mutate(power = vapply(candidate_n,simulate_data,FUN.VALUE = 1)) %>%
  group_by(candidate_n) %>%
  summarise(power = mean(power < .05))

power.grid

#Notice the inclusion of the argument `N` to specify the simulated sample size.
```

```{r question_8-quiz}
quiz(question("The appropriate sample size to detect a correlation of r = .15 with 80% is closest to:",
     answer("50"),
     answer("80"),
     answer ("170"),
     answer("260"),
     answer("350",correct),allow_retry = TRUE))
```

## Advanced Exercises


