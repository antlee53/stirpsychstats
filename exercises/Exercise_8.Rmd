---
title: "Exercise 8"
output: learnr::tutorial
runtime: shiny_prerendered
---

```{r setup, include=FALSE}
library(learnr)
library(MASS)
library(tidyverse)
library(broom)
library(pwr)
knitr::opts_chunk$set(echo = FALSE)

checker <- function(label,user_code,solution_code,check_code,envir_result,evaluate_result,envir_prep,...){
  
  envir_result
  out <- list(message = sample(c("Good Job!",
                                 "Well done!",
                                 "Great stuff!",
                                 "That is correct!",
                                 "Correct! You are really good at this."),1), correct = TRUE, location = "append")
  
#Question 1
if(label == "question_1"){
	if(!exists("custom_function")){
		out <- list(message = "There is no custom function saved as `custom_function`. Make sure to save the custom function as this object.", correct = FALSE, location = "append")
	} else {
		if(custom_function(51) != 53){
			out <- list(message = "The custom function does not appear to give the desired output. Fix the code to so that the function adds 2 to any numeric input.", correct = FALSE, location = "append")
		}
	}
}

#Question 2
if(label == "question_2"){
	if(!exists("multiply")){
		out <- list(message = "There is no custom function saved as `multiply`. Make sure to save the custom function as this object.", correct = FALSE, location = "append")
	} else {
		if(multiply(2,53) != 2*53){
			out <- list(message = "The custom function does not appear to give the desired output. Make sure there are no errors in your code so that the multiply function accepts two arguments, and return the product of those arguments.", correct = FALSE, location = "append")
		}
	}
}

#Question 3
if(label == "question_3"){
	if(!exists("center")){
		out <- list(message = "There is no custom function saved as `center`. Make sure to save the custom function as this object.", correct = FALSE, location = "append")
	} else {
		if(class(center) != "function"){
			out <- list(message = "The object saved as `center` is not a function. Make sure to save the custom function as this object.", correct = FALSE, location = "append")
		} else {
			if(center(c(12,23,34,45,56,67,78,89,90)) != (c(12,23,34,45,56,67,78,89,90) - mean(c(12,23,34,45,56,67,78,89,90)))){
				out <- list(message = "The custom function does not appear to give the desired output. Make sure there are no errors in your code so that the `center` function accepts a numeric vector, and return the centered values of that numeric vector.", correct = FALSE, location = "append")
			}
		}	
	}
}

if(label == "question_4"){

correct_exercise.data <- data.frame(ID = 1:40,
	var1 = c(131,100,76,100,103,107,98,104,116,98,79,88,116,111,108,93,86,130,83,93,81,85,104,73,113,102,89,96,100,102,89,105,88,142,116,95,96,109,106,101),
	var2 = c(46,42,48,49,45,50,46,55,59,49,45,43,56,48,47,41,54,47,49,48,51,48,41,47,47,50,36,56,47,45,56,41,50,36,57,47,58,40,51,58))
	
correct_exercise.data_centered <- mutate(correct_exercise.data,
                                 c.var1 = center(var1),
                                 c.var2 = center(var2))

	if(!exists("center")){
		out <- list(message = "There is no custom function saved as `center`. Make sure to save the custom function as this object.", correct = FALSE, location = "append")
	} else {
		if(class(center) != "function"){
			out <- list(message = "The object saved as `center` is not a function. Make sure to save the custom function as this object.", correct = FALSE, location = "append")
		} else {
			if(center(c(12,23,34,45,56,67,78,89,90)) != (c(12,23,34,45,56,67,78,89,90) - mean(c(12,23,34,45,56,67,78,89,90)))){
				out <- list(message = "The custom function does not appear to give the desired output. Make sure there are no errors in your code so that the 'center' function accepts a numeric vector, and return a numeric vector with the centered values.", correct = FALSE, location = "append")
			} else {
				if(!exists("exercise.data")){
					out <- list(message = "The data.frame `exercise.data` appears to have been altered. Do not alter this data.frame. Click the 'Start Over' button if necessary.", correct = FALSE, location = "append")
				} else {
					if(!identical(exercise.data,correct_exercise.data)){
						out <- list(message = "The data.frame `exercise.data` appears to have been altered. Do not alter this data.frame. Click the 'Start Over' button if necessary.", correct = FALSE, location = "append")
					} else {
						if(!exists("exercise.data_centered")){
							out <- list(message = "The data.frame `exercise.data_centered` does not exist. Remember to save the answer as this object.", correct = FALSE, location = "append")
						} else {
							if(!("c.var1" %in% colnames(exercise.data_centered)) | !("c.var2" %in% colnames(exercise.data_centered))){
								out <- list(message = "A variable named 'c.var1' or 'c.var2' is missing from the data.frame called `exercise.data_centered`. Make sure to name the newly centered variables as these.", correct = FALSE, location = "append")
							} else {
								if(!identical(exercise.data_centered,correct_exercise.data_centered)){
								out <- list(message = "The data.frame `exercise.data_centered` does not match the correct answer. Check there are no errors in the code and try again.", correct = FALSE, location = "append")
								}
							}
						}			
					}
				}
			}
		}	
	}
}

#Question 5    
if(label == "question_5"){
	if(!exists("sim.data")){
		out <- list(message = "There is no object saved as `sim.data`. Make sure to save the simulated data.frame as this object.", correct = FALSE, location = "append")
	} else {
		if(!is.data.frame(sim.data)){
			out <- list(message = "The object `sim.data` does not appear to be a data.frame. Make sure to save the simulated data.frame as this object.", correct = FALSE, location = "append")
		} else {
			if(!("var1" %in% colnames(sim.data)) | !("var2" %in% colnames(sim.data))){
				out <- list(message = "The object `sim.data` is missing variables either called 'var1' or 'var2'. Make sure to call the simulated variables by these names.", correct = FALSE, location = "append")
			} else {
				if(nrow(sim.data) != 40){
					out <- list(message = "The simulated data.frame saved as `sim.data` does not have 40 participants. Make sure the data has only 40 participants.", correct = FALSE, location = "append")
				} else {
					mv1 <- mean(sim.data$var1)
					mv2 <- mean(sim.data$var2)
					sv1 <- sd(sim.data$var1)
					sv2 <- sd(sim.data$var2)
					if(!(mv1 > 95 & mv1 < 105) | !(sv1 > 10 & sv1 < 20)){
						out <- list(message = "The characteristics of the simulated variable 'var1' does not appear to match the requirment of having a mean of 100 and a standard deviation of 15. Check there are no errors in the code. If you believe your code is correct, the simulated data may have fallen out of the acceptable ranges just by chance. If you believe this to be the case, submit your answer again.", correct = FALSE, location = "append")
					} else {
						if(!(mv2 > 95 & mv2 < 105) | !(sv2 > 10 & sv2 < 20)){
							out <- list(message = "The characteristics of the simulated variable 'var2' does not appear to match the requirment of having a mean of 100 and a standard deviation of 15. Check there are no errors in the code. If you believe your code is correct, the simulated data may have fallen out of the acceptable ranges by chance. If you believe this to be the case, submit your answer again.", correct = FALSE, location = "append")
						}
					}
				}
			}
		}
	}
}

#Question 6
if(label == "question_6"){
	if(!exists("simulate_data")){
		out <- list(message = "There is no object saved as `simulate_data`. Make sure to save the custom function as this object.", correct = FALSE, location = "append")
	} else {
		if(class(simulate_data) != "function"){
			out <- list(message = "The object `simulate_data` does not appear to be a function. Make sure to save the custom function as this object.", correct = FALSE, location = "append")
		} else {
			
			test.data <- simulate_data(153)
			
			if(!("var1" %in% colnames(test.data)) | !("var2" %in% colnames(test.data))){
				out <- list(message = "The function `simulate_data()` does not appear to create a data.frame with the correct characteristics. It produces a data.frame that is missing variables either called 'var1' or 'var2'.", correct = FALSE, location = "append")
			} else {
				if(nrow(test.data) != 153){
					out <- list(message = "The simulated data.frame from the function `simulate_data()` does not appear to match what is specified in an argument. Edit the function so that the first argument specifies the sample size of the simulated data.", correct = FALSE, location = "append")
				} else {
					mv1 <- mean(test.data$var1)
					mv2 <- mean(test.data$var2)
					sv1 <- sd(test.data$var1)
					sv2 <- sd(test.data$var2)
					if(!(mv1 > 95 & mv1 < 105) | !(sv1 > 10 & sv1 < 20)){
						out <- list(message = "The characteristics of the simulated variable 'var1' resulting from the function `simulate_data()` does not appear to match the requirment of having a mean of 100 and a standard deviation of 15. Check there are no errors in the code. If you believe your code is correct, the simulated data may have fallen out of the acceptable ranges by chance. If you believe this to be the case, submit your answer again.", correct = FALSE, location = "append")
					} else {
						if(!(mv2 > 95 & mv2 < 105) | !(sv2 > 10 & sv2 < 20)){
							out <- list(message = "The characteristics of the simulated variable 'var2' resulting from the function `simulate_data()` does not appear to match the requirment of having a mean of 100 and a standard deviation of 15. Check there are no errors in the code. If you believe your code is correct, the simulated data may have fallen out of the acceptable ranges by chance. If you believe this to be the case, submit your answer again.", correct = FALSE, location = "append")
						}
					}
				}
			}
		}
	}
}
        
return(out)
}

tutorial_options(exercise.checker = checker)
```

## Introduction

Welcome to the weekly exercise for demonstration 8. These exercises are designed to reinforce content taught each week. Typically, they consist of quiz questions and R exercises that require you to enter code into a box. These exercises are split into beginner and advance sections. It is expected that students can complete the beginner sections of each weekly exercise, with the advanced sections designed for students who want an extra challenge or learn additional functions in R. If you are struggling, each exercise comes with a number of hints that may be helpful.

## Basic Exercises

### Question 1

The custom function below is meant to add 2 to any numeric input; however, currently the function doesn't work. Edit the code to fix the function.

```{r question_1-setup}

```

```{r question_1, exercise=TRUE,exercise.lines = 6}
custom_function <- function(numeric_input){
  output <- numeric_input + 2
  numeric_input
}
```

```{r question_1-hint-1}
Whenever you create a custom function, everything within the curly brackets is in a separate working environment.
```

```{r question_1-hint-2}
R needs to be told what to return from a custom function by using the `return()` function. To check how your function is performing, try running it and see if you get the intended effect.

Next hint will show the solution...
```

```{r question_1-solution}
custom_function <- function(numeric_input){
  output <- numeric_input + 2
  return(output)
}
#Add the `return()` function.
```

```{r question_1-check}
checker()
```

### Question 2

Create a function that takes two numeric inputs, and returns the multiplication of those two numbers. Save this custom function as the object `multiply()`.

```{r question_2-setup}

```

```{r question_2, exercise=TRUE,exercise.lines = 6}
multiply <- 
```

```{r question_2-hint-1}
Specify the arguments necessary for your custom function within the `function()` command.
```

```{r question_2-hint-2}
Remember to include what you want your function to do within curly brackets.

Next hint will show the solution...
```

```{r question_2-solution}
#Example Answer:
multiply <- function(number1,number2){
  output <- number1*number2
  return(output)
}
```

```{r question_2-check}
checker()
```

### Question 3

Below is code that centers a vector of numeric values. Put this code within a custom function named `center` so that you can easily center any vector of numeric values.

```{r question_3, exercise=TRUE,exercise.lines = 10}
numeric_vector <- c(12,23,34,45,56,67,78,89,90)
numeric_mean <- mean(numeric_vector,na.rm = TRUE)
numeric_center <- numeric_vector - numeric_mean
```

```{r question_3-hint-1}
Create a custom function by using the `function()` command.
```

```{r question_3-hint-2}
Remember to include what you want your function to do within curly brackets.

Next hint will show the solution...
```

```{r question_3-solution}
#Example Answer:
center <- function(numeric_vector){
  numeric_mean <- mean(numeric_vector,na.rm = TRUE)
  numeric_center <- numeric_vector - numeric_mean
  return(numeric_center)
}
```

```{r question_3-check}
checker()
```

### Question 4

Use the `center()` function created in Question 3 to center the variables 'var1' and 'var2' in the data.frame `exercise.data` below. Save the new data.frame as `exercise.data_centered` and the new variables as 'c.var1' and 'c.var2' respectively.

```{r question_4-setup}
exercise.data <- data.frame(ID = 1:40,
	var1 = c(131,100,76,100,103,107,98,104,116,98,79,88,116,111,108,93,86,130,83,93,81,85,104,73,113,102,89,96,100,102,89,105,88,142,116,95,96,109,106,101),
	var2 = c(46,42,48,49,45,50,46,55,59,49,45,43,56,48,47,41,54,47,49,48,51,48,41,47,47,50,36,56,47,45,56,41,50,36,57,47,58,40,51,58))
```

```{r question_4, exercise=TRUE,exercise.lines = 15}
center <- function(numeric_vector){
  numeric_mean <- mean(numeric_vector,na.rm = TRUE)
  numeric_center <- numeric_vector - numeric_mean
  return(numeric_center)
}

#exercise.data

exercise.data_centered <- 
```

```{r question_4-hint-1}
Use the `mutate()` function from the tidyverse package to manipulate a variable in a data.frame. You can use functions within the `mutate()` function.
```

```{r question_4-hint-2}
Edit the code below to get the correct answer:
  
exercise.data_centered <- mutate(exercise.data,
                                 c.var1 = ,
                                 c.var2 = )

Next hint will show the solution...
```

```{r question_4-solution}
#Example Answer:
center <- function(numeric_vector){
  numeric_mean <- mean(numeric_vector,na.rm = TRUE)
  numeric_center <- numeric_vector - numeric_mean
  return(numeric_center)
}

exercise.data_centered <- mutate(exercise.data,
                                 c.var1 = center(var1),
                                 c.var2 = center(var2))
```

```{r question_4-check}
checker()
```

### Question 5

Create a simulated data.frame with 40 participants and two, random continuous variables with a mean of 100 and a standard deviation of 15. Save the data.frame as `sim.data` and name the two variables `var1` and `var2`.

```{r question_5-setup}

```

```{r question_5, exercise=TRUE,exercise.lines = 7}

sim.data <- 

```

```{r question_5-hint-1}
Use the `rnorm()` function to create a random normal distribution. Type `help(rnorm)` into the console if you need help with how this function works.
```

```{r question_5-hint-2}
Edit the code below to get the correct answer:
  
sim.data <- data.frame(
  var1 = ,
  var2 = 
)

Next hint will show the solution...
```

```{r question_5-solution}
#Example Answer:
sim.data <- data.frame(
  var1 = rnorm(40, mean = 100,sd = 15),
  var2 = rnorm(40, mean = 100,sd = 15)
)
```

```{r question_5-check}
checker()
```

### Question 6

Adapt the code from Question 5 to create a function that simulates data a data.frame with two continuous variables. Name this function `simulate_data`. Create the function so that it accepts one argument, which specifies the sample size of the simulated data.frame.

```{r question_6-setup}

```

```{r question_6, exercise=TRUE,exercise.lines = 15}
sim.data <- data.frame(
  var1 = rnorm(40, mean = 100,sd = 15),
  var2 = rnorm(40, mean = 100,sd = 15)
)

simulate_data <- function(){
  
}

```

```{r question_6-hint-1}
Remember to include what you want your function to do within curly brackets.
```

```{r question_6-hint-2}
Arguments you want your function to have goes within the brackets when using the `function()` command.

Next hint will show the solution...
```

```{r question_6-solution}
#Example Answer:
simulate_data <- function(N){
  sim.data <- data.frame(
  var1 = rnorm(N, mean = 100,sd = 15),
  var2 = rnorm(N, mean = 100,sd = 15)
  )
  return(sim.data)
}
```

```{r question_6-check}
checker()
```

### Question 7

The code below creates a function that simulates a data.frame with 40 participants and two continuous variables with a correlation of r = .15, conducts a correlation between the two, then returns a p-value. Use the `replicate()` function to determine the power this analysis has to detect an effect of r > .15 or greater. Note, you don't need to understand exactly what the code within the simulate_data function does. As long as you get the gist of the function you should be able to complete this question.

```{r question_7-setup}

```

```{r question_7, exercise=TRUE,exercise.lines = 15}
simulate_data <- function(){
  sim.data <- mvrnorm(40,mu = c(0,0),Sigma = matrix(c(1,.15,.15,1),ncol = 2,nrow = 2)) %>%
    as.data.frame()
  colnames(sim.data) <- c("var1","var2")
  correlation <- cor.test(~ var1 + var2,sim.data) %>% tidy()
  p.value <- pull(correlation,p.value)
  return(p.value)
}



```

```{r question_7-hint-1}
The replicate function repeats a specified function a specified number of times, and returns the output from each of the repititons in a vector (usually).
```

```{r question_7-hint-2}
Power is the chance of finding a significant effect if it is there. Given we know that there is an effect of r = .15 in the simulated data.frame, the proportion of times a significant effect is found (i.e., the p.value is less than .05) is the power.

Next hint will show the solution...
```

```{r question_7-solution}
#Example Answer:
simulate_data <- function(){
  sim.data <- mvrnorm(40,mu = c(0,0),Sigma = matrix(c(1,.15,.15,1),ncol = 2,nrow = 2)) %>%
    as.data.frame()
  colnames(sim.data) <- c("var1","var2")
  correlation <- cor.test(~ var1 + var2,sim.data) %>% tidy()
  p.value <- pull(correlation,p.value)
  return(p.value)
}

p.values <- replicate(1000,simulate_data())
power <- mean(p.values < .05)
power
```

```{r question_7-quiz}
quiz(question("The power to detect a correlation of r = .15 with a sample size of 40 is closest to:",
     answer("0%"),
     answer("15%",correct = TRUE),
     answer ("50%"),
     answer("80%"),
     answer("100%"),allow_retry = TRUE))
```

### Question 8

Adjust the code from Question 7 (or, use a function from the pwr package) to determine the appropriate sample size to detect a correlation of r = .15 with 80% power.

```{r question_8-setup}

```

```{r question_8, exercise=TRUE,exercise.lines = 15}
simulate_data <- function(){
  sim.data <- mvrnorm(40,mu = c(0,0),Sigma = matrix(c(1,.15,.15,1),ncol = 2,nrow = 2)) %>%
    as.data.frame()
  colnames(sim.data) <- c("var1","var2")
  correlation <- cor.test(~ var1 + var2,sim.data) %>% tidy()
  p.value <- pull(correlation,p.value)
  return(p.value)
}

p.values <- replicate(1000,simulate_data())
power <- mean(p.values < .05)
```

```{r question_8-hint-1}
First, you will need to adjust the custom function so that the simulated data.frame can vary according to sample size. This can be done by adding an argument... (Currently the `simulated_data` function creates a data.frame with 40 participants).

Once you have a function where you can adjust the sample size, you will want to run the function multiple times at different sample sizes to determine the proportion of times a significant effect is found...
```

```{r question_8-hint-2}
If all this seems overly complicated and unnecessary, it is because it is. An easier way to calculate the required sample size for a correlation is use the pwr.r.test() function from the pwr package.

Next hint will show the solution...
```

```{r question_8-solution}
#Example Answer:
simulate_data <- function(N){
  sim.data <- mvrnorm(N,mu = c(0,0),Sigma = matrix(c(1,.15,.15,1),ncol = 2,nrow = 2)) %>%
    as.data.frame()
  colnames(sim.data) <- c("var1","var2")
  correlation <- cor.test(~ var1 + var2,sim.data) %>% tidy()
  p.value <- pull(correlation,p.value)
  return(p.value)
}

power.grid <- data.frame(candidate_n = rep(seq(50,380,by = 30),each = 100)) %>%
  mutate(power = vapply(candidate_n,simulate_data,FUN.VALUE = 1)) %>%
  group_by(candidate_n) %>%
  summarise(power = mean(power < .05))

power.grid

#Notice the inclusion of the argument `N` to specify the simulated sample size.
#It is probably easier to use the pwr package:

pwr.r.test(r = .15,power = .80,sig.level = .05)
```

```{r question_8-quiz}
quiz(question("The appropriate sample size to detect a correlation of r = .15 with 80% is closest to:",
     answer("50"),
     answer("80"),
     answer ("170"),
     answer("260"),
     answer("350",correct = TRUE),allow_retry = TRUE))
```

## Advanced Exercises

This week's advanced exercises focuses on expanding the uses of ANOVA. Up to now, we have only considered the one-way ANOVA, which deals with the relationship between one categorical IV and a continuous DV. However, the ANOVA can be used to deal with multiple IVs, as well as IVs that are both within-subjects and between-subjects.

### Question A1 - Two-way ANOVA

A two-way ANOVA is used when you want to evaluate the effects of two categorical IVs on a continuous DV. Much of what we have covered regarding a linear regression with multiple predictors applies with a two-way ANOVA, but with two categorical IVs.

The two-way ANOVA can test several effects simultaneously:
1. A main effect of one IV.
1. A main effect of the other IV.
1. An interaction effect between both IVs.

The function to run a two-way ANOVA is the same as a one-way ANOVA: `aov()`. R is smart enough to determine which statistical test to run based on how many IVs are in the formula. Also similar to the one-way ANOVA, in order to get output that is interpretable, you can pipe the result to the `summary()` function.

So to run a two-way ANOVA, the code should look something like the following:

```{r,eval = FALSE}
aov(DV ~ IV1*IV2,data = data) %>%
  summary()
```

The way to read the formula above is identical to an interaction for a regression (i.e., this tests for two main effects for both IVs, and an interaction effect).

In the code box below, there is a dataset testing whether the use an experimental drug helps with anxiety. In a randomised controlled trial, participants are either assigned the the experimental drug condition, or a control group. Participants are also randomly assigned to one of three dosage groups (low, medium, and high). Conduct a two-way ANOVA to determine whether the use of the drug, as well as dosage levels, helps with levels of anxiety.

```{r question_a1-setup}
anxiety.data <- data.frame(ID = 1:120,
	drug_condition = c(rep("experimental",60),rep("control",60)),
	dosage = c(rep("low",20),rep("medium",20),rep("high",20),rep("low",20),rep("medium",20),rep("high",20)),
	anxiety = c(50,43,39,46,43,32,66,33,38,44,39,16,38,45,-3,51,20,43,57,48,30,40,50,60,-1,56,36,42,50,34,33,34,43,34,18,17,19,27,35,31,3,33,28,17,27,41,9,32,15,9,15,33,5,31,24,-11,16,39,-2,36,48,46,37,73,37,40,32,53,38,34,26,35,22,20,74,19,26,51,60,32,45,60,56,28,70,40,45,19,46,57,52,54,35,22,37,10,25,50,36,61,50,29,30,42,58,47,63,58,21,48,78,54,39,29,48,46,69,46,34,54))
```

```{r question_a1, exercise=TRUE,exercise.lines = 12}
#anxiety.data


```

```{r question_a1-hint-1}
Use the `aov()` function to conduct the two-way ANOVA.
```

```{r question_a1-hint-2}
Remember the formula should include the interaction between the two IVs.

Next hint will show the solution...
```

```{r question_a1-solution}
aov(anxiety ~ drug_condition*dosage,data = anxiety.data) %>%
  summary()
```

### Question A2 - Repeated Measures (Within-Subjects) ANOVA

The repeated-measures ANOVA (also known as a within-subjects ANOVA) is used to analyse data where participants are measured more than once (much like the paired-samples t-test). As with all ANOVAs up to this point, here you would have a categorical IV (with more than two levels) and a continuous DV.

Much like with the paired-samples t-test, before conducting the analysis, you will first need to reshape the data from short to long format. We do this using the `gather()` function, which we cover in more detail in Workbook 10.

```{r,eval = FALSE}
data.reshaped <- gather(key = "condition",value = "response",var1,var2)
```

You can use the `aov()` function to conduct a repeated measures ANOVA. In order to tell the function that it is within-subjects, however, you will need to specify this in the formula. In the example below, we are predicting `response` based on `condition`. The part of the code that goes `+ Error(Subject/Condition)` tells the `aov()` function that the variable `condition` is repeated based on the `Subject` variable.

```{r,eval = FALSE}
aov(response ~ condition + Error(Subject/condition),data.reshaped) %>%
  summary()
```

```{r question_a2-setup}
engagement.data <- data.frame(
  Subject = c(rep("Brandon",3),rep("Dave",3),rep("Mark",3),rep("Ronnie",3)),
  Condition = c(rep(c("Early","Middle","Late"),times = 4)),
  Output = c(23,21,20,7,17,1,9,19,11,5,20,13)
)
```

In the code box below, there is a dataset testing the engagement of four participants in a group activity across three conditions (higher number of output means greater engagement). Conduct a repeated measures ANOVA to determine whether engagement differs according to condition. Note, the dataset has already been reshaped.

```{r question_a2, exercise=TRUE,exercise.lines = 12}
#engagement.data


```

```{r question_a2-hint-1}
Use the `aov()` function to conduct a repeated measures ANOVA.
```

```{r question_a2-hint-2}
Remember the formula should include a part that tells the function that a variable is repeated within another variable. This takes the form of `+ Error(.../...)`

Next hint will show the solution...
```

```{r question_a2-solution}
aov(Output ~ Condition + Error(Subject/Condition),data = engagement.data) %>%
  summary()
```

### Question A3 - Mixed-Design ANOVA

A mixed design ANOVA is used when you want to test the interaction between a categorical between-subjects variable, and a cateogrical within-subjects variable (the "mixed design" part refers to the fact that one IV is between-subjects, while the other is within-subjects).

The mixed design ANOVA combines elements from the two-way ANOVA and repeated measures ANOVA above. First, we include an interaction term between the two IVs. Second, we need to include in the formula the part that tells the function which variable is within subjects.

In the example below, we are testing for the interaction between var1 and var2, with var1 being a within-subjects variable.

```{r}
aov(DV ~ var1*var2 + Error(Subject/var1),data.reshaped) %>%
  summary()
```

```{r question_a3-setup}
pd <- matrix(c("Neale","M",105,100,
              "Zorko","M",104,97,
              "Lyons","M",98,95,
              "Robinson","M",94,88,
              "McCluggage","M",91,78,
              "Rich","D",88,72,
              "Ellis-Yolmen","M",88,82,
              "Martin","R",85,101,
              "Berry","M",80,77,
              "Witherden","D",75,88,
              "Cameron","F",67,65,
              "Christensen","F",64,65,
              "Ah Chee","M",62,59,
              "McCarthy","F",60,49,
              "Gardiner","D",58,60,
              "Hipwood","F",57,56,
              "Mathieson","F",57,62,
              "Andrews","D",56,67,
              "McInerney","R",56,53,
              "Lester","D",56,64,
              "McStay","F",52,52,
              "Adams","D",49,62,
              "Bailey","D",48,52,
              "Smith","R",46,46,
              "Rayner","F",45,59,
              "Cox","F",44,38,
              "Allison","M",44,48,
              "Starcevich","D",31,34),byrow = TRUE,ncol = 4)
performance.data <- data.frame(ID = as.character(pd[,1]),
                               regiment = as.character(pd[,2]),
                               Y2019 = as.numeric(pd[,3]),
                               Y2018 = as.numeric(pd[,4])) %>%
  gather(key = "year",value = "performance",Y2018,Y2019)
```

In the code box below, there is a dataset testing the performance of elite athletes in two years (higher number of output means greater engagement). These athletes also fall into one of four groups based on their training regiment. Conduct a mixed design ANOVA to determine whether performance differs based on the training regiment, and whether this interacts with the year the data was collected (e.g., are certain training regiments more effective over time?). Note, the dataset has already been reshaped.

```{r question_a3, exercise=TRUE,exercise.lines = 12}
#performance.data


```

```{r question_a2-hint-1}
Use the `aov()` function to conduct a mixed design ANOVA.
```

```{r question_a3-hint-2}
Remember the formula should include an interaction term and a part that tells the function that a variable is repeated within another variable. This takes the form of `+ Error(.../...)`

Next hint will show the solution...
```

```{r question_a3-solution}
aov(performance ~ year*regiment + Error(ID/year),data = performance.data) %>%
  summary()
```
