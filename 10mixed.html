<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>HPSP131 - Workbook 10 - Mixed Effects Modelling</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/flatly.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet" />
<script src="site_libs/pagedtable-1.1/js/pagedtable.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>




<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 60px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h2 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h3 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h4 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h5 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h6 {
  padding-top: 65px;
  margin-top: -65px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}


.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">HPSP131</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="1intro.html">1. Intro</a>
</li>
<li>
  <a href="2data.html">2. Data 1</a>
</li>
<li>
  <a href="7GLM.html">3. Data 2</a>
</li>
<li>
  <a href="3plot.html">4. Plot</a>
</li>
<li>
  <a href="4LM1.html">5. LM1</a>
</li>
<li>
  <a href="5LM2.html">6. LM2</a>
</li>
<li>
  <a href="6mod_med2.html">7. Mod</a>
</li>
<li>
  <a href="8sim.html">8. Power</a>
</li>
<li>
  <a href="9SEM.html">9. SEM</a>
</li>
<li>
  <a href="10mixed.html">10. Mixed</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="exercises.html">Exercises</a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">HPSP131 - Workbook 10 - Mixed Effects Modelling</h1>

</div>


<div id="objectives" class="section level1">
<h1>Objectives</h1>
<p>The aim of this week is to introduce the lme4 package for Linear Mixed Effect Modelling in R. By the end of this workbook, you should be familiar with:</p>
<ol style="list-style-type: decimal">
<li>The basics of the lme4 package and <code>lmer()</code> function.</li>
<li>Run a basic linear mixed effects model.</li>
<li>Understand the data reshaping functions <code>spread()</code> and <code>gather()</code>.</li>
</ol>
</div>
<div id="resources" class="section level1">
<h1>Resources</h1>
<p>Here is a list of resources that may help you with this weeks content:</p>
<p>In this workbook, we will be using data from Lee, DeBruine, and Jones (2018), which you can download at this osf link (<a href="https://osf.io/xcy8j/">https://osf.io/ecy8j</a>; download the ‘future.discounting.csv’ file).</p>
<pre class="r"><code>fd.data &lt;- read_csv(&quot;files/future.discounting.csv&quot;)</code></pre>
</div>
<div id="exercises" class="section level1">
<h1>Exercises</h1>
<p><a href = "exercises.html">Click here to download this week’s exercises.</a></p>
</div>
<div id="content" class="section level1">
<h1>Content</h1>
<p>These are the packages we will be using in this week’s workbook.</p>
<pre class="r"><code>library(tidyverse)
library(knitr)
library(lme4)
library(lmerTest)</code></pre>
<div id="linear-mixed-effects-modelling" class="section level2">
<h2>Linear Mixed Effects Modelling</h2>
<p>As covered in Lectures, one of the advantages of using Mixed Effects Modelling is when your data violates the assumption of non-independence. A common example is when conducting cross-national research, where responses from different people in the same country may be more similar to each other than responses from people in a different country for reasons not captured in your model. In the following analysis, we will test the influence of age on future discounting behaviour across nations.</p>
<div id="clean-data-for-analysis." class="section level3">
<h3>1. Clean data for analysis.</h3>
<p>First, we need to calculate a future discounting score for each participant, standardise age, and remove participants with missing data. We also remove participants with unrealistic ages (over 100-years-old or under 6-years-old) and participants from countries where we have less than 10 participants.</p>
<pre class="r"><code>data_clean &lt;- fd.data %&gt;%
  drop_na(age,kirby1,kirby2,kirby3,kirby4,kirby5,kirby6,kirby7,kirby8,kirby9) %&gt;%
  mutate(kirby.total = kirby1 + kirby2 + kirby3 + kirby4 + kirby5 + kirby6 + kirby7 + kirby8 + kirby9,
         z.age = c(scale(age))) %&gt;%
  filter(age &lt;= 100) %&gt;%
  filter(age &gt;= 6) %&gt;%
  group_by(resident) %&gt;%
  filter(n() &gt;= 10) %&gt;%
  ungroup()</code></pre>
</div>
<div id="conduct-analysis." class="section level3">
<h3>2. Conduct analysis.</h3>
<p>To run a linear mixed effects model, we use the <code>lmer()</code> function from the <code>lme4</code> package, that has been adapted by the <code>lmerTest</code> package.</p>
<p>Like all analyses conducted in previous workbooks, we need two things when conducting a mixed effect model: a formula, and a data.frame.</p>
<p>Here is an example of a formula for a mixed effects model:</p>
<blockquote>
<p>y ~ x1 + (1 + x1 | group1)</p>
</blockquote>
<p>To specify fixed effects, the formula is identical to that of a normal regression. However, to specify random effects, we need to introduce some new syntax. In the formula above, random effects are specified within the brackets, that contains a <code>|</code> symbol. The variable on the right of the <code>|</code> specifies the grouping variable. Everything on the left specifies the random effects. A <code>1</code> indicates we want a random intercept (i.e., we expect scores on y to vary depending on group1). Variables on the lefthand side indicate we want random slopes (i.e., in the example above, we expect the effect of x1 on y to vary depending on group1).</p>
<p>So in our future discounting analysis, we want a fixed effect of participant age, a random intercept of residence, and a random slope of age depending on residence, so our formula is:</p>
<pre class="r"><code>formula &lt;- &#39;kirby.total ~ z.age + (1 + z.age | resident)&#39;</code></pre>
<p>We then feed that into the <code>lmer()</code> function:</p>
<pre class="r"><code>model &lt;- lmer(formula,data = data_clean)
summary(model)</code></pre>
<pre><code>## Linear mixed model fit by REML. t-tests use Satterthwaite&#39;s method [
## lmerModLmerTest]
## Formula: formula
##    Data: data_clean
## 
## REML criterion at convergence: 53007.9
## 
## Scaled residuals: 
##     Min      1Q  Median      3Q     Max 
## -2.6693 -0.5850  0.0217  0.6116  3.4501 
## 
## Random effects:
##  Groups   Name        Variance Std.Dev. Corr 
##  resident (Intercept) 0.09542  0.3089        
##           z.age       0.15325  0.3915   -1.00
##  Residual             3.08354  1.7560        
## Number of obs: 13355, groups:  resident, 55
## 
## Fixed effects:
##             Estimate Std. Error       df t value Pr(&gt;|t|)    
## (Intercept)  3.73685    0.05485 35.21128  68.125  &lt; 2e-16 ***
## z.age        1.31037    0.16282 28.25146   8.048  8.6e-09 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Correlation of Fixed Effects:
##       (Intr)
## z.age -0.288
## convergence code: 0
## boundary (singular) fit: see ?isSingular</code></pre>
<p>In the summary above, there are two tables of interest. In most cases, you will be interested in the ‘fixed effects’ table. This can be interpreted in the same way you would interpret a regression table. Note though, that estimates are unstandardised.</p>
<p>The other table is the ‘random effects’ table, which gives you information about variability in your model. So in the example above, scores on future discounting vary by .31 standard deviations depending on residence, the effect of age on future discounting varies by .39 standard deviations depending on residence, while 1.76 standard deviations of future discounting is residual (i.e., not explained by the model).</p>
<p>Sometimes, when running a mixed effect model, you will receive an error message that says the model failed to converge. This means that the analysis did not find a single solution, so we cannot be confident in the results above. If this occurs, the next step is to simplify the random effects structure. One way to do this is to force the random effects to be uncorrelated, which can be specified by using two of the <code>|</code> symbol inside the brackets. For more information on specifying random effects maximally, read <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC3881361/">Barr et al. (2013)</a>.</p>
</div>
<div id="plot-the-data" class="section level3">
<h3>3. Plot the Data</h3>
<p>In the plot below, each of the blue lines represents the relationship between age and future discounting for each country, while the red line is the overall relationship.</p>
<pre class="r"><code>ggplot(data = data_clean,aes(x = age,y = kirby.total)) +
  geom_smooth(aes(group = resident),method = &quot;lm&quot;,formula = y ~ x, colour = &quot;blue&quot;,se = FALSE,size = .1) +
  geom_smooth(method = &quot;lm&quot;,formula = y ~ x, colour = &quot;red&quot;)</code></pre>
<p><img src="10mixed_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
</div>
</div>
<div id="another-example" class="section level2">
<h2>Another Example</h2>
<p>In the above example, the level of analysis was at the participant-level. However, since each participant completed 9 inter-temporal choice items, arguably the more appropriate level of analysis is at the item-level.</p>
<div id="prepare-the-data" class="section level3">
<h3>Prepare the data</h3>
<p>For all analyses to this point, we have required the data to have the structure that one row represents data from one participant. However, this may not be the case when conducting a linear mixed effects model. For a mixed effects model, each row must represent one observation (i.e., Level 1).</p>
<p>For example, let’s say we want to investigate the influences on what participants find attractive in a face, so we conduct a study where each participant rates 9 faces. If we formatted our data so that each participant was on one row, our data would look something like this:</p>
<pre class="r"><code>data_short &lt;- data.frame(participant_ID = 1:40,
                         face1 = sample(1:9,40,replace = TRUE),
                         face2 = sample(1:9,40,replace = TRUE),
                         face3 = sample(1:9,40,replace = TRUE),
                         face4 = sample(1:9,40,replace = TRUE),
                         face5 = sample(1:9,40,replace = TRUE),
                         face6 = sample(1:9,40,replace = TRUE),
                         face7 = sample(1:9,40,replace = TRUE),
                         face8 = sample(1:9,40,replace = TRUE),
                         face9 = sample(1:9,40,replace = TRUE))
data_long &lt;- gather(data_short,key = &quot;face&quot;,value = &quot;rating&quot;,face1:face9) %&gt;%
  arrange(participant_ID,face)</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["participant_ID"],"name":[1],"type":["int"],"align":["right"]},{"label":["face1"],"name":[2],"type":["int"],"align":["right"]},{"label":["face2"],"name":[3],"type":["int"],"align":["right"]},{"label":["face3"],"name":[4],"type":["int"],"align":["right"]},{"label":["face4"],"name":[5],"type":["int"],"align":["right"]},{"label":["face5"],"name":[6],"type":["int"],"align":["right"]},{"label":["face6"],"name":[7],"type":["int"],"align":["right"]},{"label":["face7"],"name":[8],"type":["int"],"align":["right"]},{"label":["face8"],"name":[9],"type":["int"],"align":["right"]},{"label":["face9"],"name":[10],"type":["int"],"align":["right"]}],"data":[{"1":"1","2":"6","3":"2","4":"2","5":"2","6":"4","7":"7","8":"4","9":"9","10":"8"},{"1":"2","2":"6","3":"4","4":"4","5":"4","6":"1","7":"8","8":"1","9":"7","10":"2"},{"1":"3","2":"2","3":"5","4":"7","5":"2","6":"7","7":"4","8":"2","9":"6","10":"2"},{"1":"4","2":"4","3":"1","4":"6","5":"6","6":"3","7":"6","8":"7","9":"1","10":"6"},{"1":"5","2":"5","3":"3","4":"1","5":"9","6":"1","7":"8","8":"9","9":"6","10":"4"},{"1":"6","2":"6","3":"8","4":"2","5":"1","6":"2","7":"4","8":"1","9":"1","10":"4"},{"1":"7","2":"8","3":"1","4":"1","5":"8","6":"3","7":"7","8":"7","9":"4","10":"2"},{"1":"8","2":"7","3":"6","4":"5","5":"9","6":"4","7":"3","8":"2","9":"9","10":"6"},{"1":"9","2":"6","3":"4","4":"9","5":"7","6":"7","7":"3","8":"4","9":"3","10":"6"},{"1":"10","2":"2","3":"4","4":"4","5":"9","6":"9","7":"3","8":"5","9":"3","10":"7"},{"1":"11","2":"1","3":"7","4":"1","5":"4","6":"4","7":"8","8":"1","9":"2","10":"2"},{"1":"12","2":"7","3":"8","4":"3","5":"8","6":"6","7":"7","8":"3","9":"7","10":"9"},{"1":"13","2":"1","3":"4","4":"4","5":"2","6":"4","7":"4","8":"6","9":"9","10":"3"},{"1":"14","2":"5","3":"1","4":"7","5":"1","6":"6","7":"1","8":"2","9":"5","10":"1"},{"1":"15","2":"9","3":"8","4":"9","5":"1","6":"9","7":"2","8":"8","9":"6","10":"4"},{"1":"16","2":"4","3":"8","4":"1","5":"4","6":"6","7":"6","8":"1","9":"1","10":"9"},{"1":"17","2":"8","3":"1","4":"5","5":"4","6":"2","7":"3","8":"3","9":"9","10":"5"},{"1":"18","2":"6","3":"5","4":"2","5":"6","6":"5","7":"3","8":"5","9":"2","10":"4"},{"1":"19","2":"6","3":"4","4":"7","5":"9","6":"5","7":"4","8":"8","9":"9","10":"7"},{"1":"20","2":"1","3":"1","4":"8","5":"1","6":"5","7":"5","8":"5","9":"5","10":"5"},{"1":"21","2":"3","3":"6","4":"6","5":"5","6":"5","7":"5","8":"1","9":"2","10":"7"},{"1":"22","2":"3","3":"7","4":"2","5":"1","6":"9","7":"4","8":"5","9":"8","10":"8"},{"1":"23","2":"1","3":"8","4":"6","5":"8","6":"4","7":"1","8":"8","9":"3","10":"9"},{"1":"24","2":"4","3":"4","4":"4","5":"5","6":"5","7":"2","8":"6","9":"4","10":"6"},{"1":"25","2":"9","3":"3","4":"6","5":"3","6":"9","7":"3","8":"2","9":"2","10":"2"},{"1":"26","2":"1","3":"4","4":"9","5":"4","6":"9","7":"4","8":"6","9":"8","10":"3"},{"1":"27","2":"5","3":"7","4":"1","5":"2","6":"1","7":"5","8":"1","9":"8","10":"9"},{"1":"28","2":"1","3":"5","4":"3","5":"3","6":"5","7":"7","8":"3","9":"1","10":"7"},{"1":"29","2":"4","3":"8","4":"1","5":"6","6":"6","7":"7","8":"9","9":"1","10":"8"},{"1":"30","2":"3","3":"3","4":"7","5":"8","6":"8","7":"5","8":"7","9":"5","10":"5"},{"1":"31","2":"5","3":"8","4":"2","5":"7","6":"2","7":"9","8":"3","9":"6","10":"4"},{"1":"32","2":"5","3":"3","4":"7","5":"4","6":"2","7":"4","8":"1","9":"2","10":"7"},{"1":"33","2":"9","3":"7","4":"4","5":"3","6":"5","7":"4","8":"3","9":"5","10":"3"},{"1":"34","2":"2","3":"3","4":"7","5":"2","6":"1","7":"8","8":"4","9":"2","10":"5"},{"1":"35","2":"7","3":"5","4":"3","5":"6","6":"7","7":"5","8":"2","9":"4","10":"5"},{"1":"36","2":"3","3":"4","4":"6","5":"5","6":"2","7":"9","8":"1","9":"2","10":"4"},{"1":"37","2":"2","3":"3","4":"2","5":"1","6":"5","7":"2","8":"2","9":"6","10":"2"},{"1":"38","2":"8","3":"7","4":"7","5":"7","6":"9","7":"5","8":"4","9":"5","10":"5"},{"1":"39","2":"8","3":"9","4":"9","5":"5","6":"2","7":"3","8":"1","9":"1","10":"5"},{"1":"40","2":"6","3":"2","4":"7","5":"3","6":"2","7":"5","8":"9","9":"2","10":"9"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>However, to conduct an mixed effects model, we require each row to represent one observation. In this instance, one observation is one rating made by one participant about one face. Therefore, data from one participant would be separated into 9 rows, (one for each rating they gave), and look something like this:</p>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["participant_ID"],"name":[1],"type":["int"],"align":["right"]},{"label":["face"],"name":[2],"type":["chr"],"align":["left"]},{"label":["rating"],"name":[3],"type":["int"],"align":["right"]}],"data":[{"1":"1","2":"face1","3":"6"},{"1":"1","2":"face2","3":"2"},{"1":"1","2":"face3","3":"2"},{"1":"1","2":"face4","3":"2"},{"1":"1","2":"face5","3":"4"},{"1":"1","2":"face6","3":"7"},{"1":"1","2":"face7","3":"4"},{"1":"1","2":"face8","3":"9"},{"1":"1","2":"face9","3":"8"},{"1":"2","2":"face1","3":"6"},{"1":"2","2":"face2","3":"4"},{"1":"2","2":"face3","3":"4"},{"1":"2","2":"face4","3":"4"},{"1":"2","2":"face5","3":"1"},{"1":"2","2":"face6","3":"8"},{"1":"2","2":"face7","3":"1"},{"1":"2","2":"face8","3":"7"},{"1":"2","2":"face9","3":"2"},{"1":"3","2":"face1","3":"2"},{"1":"3","2":"face2","3":"5"},{"1":"3","2":"face3","3":"7"},{"1":"3","2":"face4","3":"2"},{"1":"3","2":"face5","3":"7"},{"1":"3","2":"face6","3":"4"},{"1":"3","2":"face7","3":"2"},{"1":"3","2":"face8","3":"6"},{"1":"3","2":"face9","3":"2"},{"1":"4","2":"face1","3":"4"},{"1":"4","2":"face2","3":"1"},{"1":"4","2":"face3","3":"6"},{"1":"4","2":"face4","3":"6"},{"1":"4","2":"face5","3":"3"},{"1":"4","2":"face6","3":"6"},{"1":"4","2":"face7","3":"7"},{"1":"4","2":"face8","3":"1"},{"1":"4","2":"face9","3":"6"},{"1":"5","2":"face1","3":"5"},{"1":"5","2":"face2","3":"3"},{"1":"5","2":"face3","3":"1"},{"1":"5","2":"face4","3":"9"},{"1":"5","2":"face5","3":"1"},{"1":"5","2":"face6","3":"8"},{"1":"5","2":"face7","3":"9"},{"1":"5","2":"face8","3":"6"},{"1":"5","2":"face9","3":"4"},{"1":"6","2":"face1","3":"6"},{"1":"6","2":"face2","3":"8"},{"1":"6","2":"face3","3":"2"},{"1":"6","2":"face4","3":"1"},{"1":"6","2":"face5","3":"2"},{"1":"6","2":"face6","3":"4"},{"1":"6","2":"face7","3":"1"},{"1":"6","2":"face8","3":"1"},{"1":"6","2":"face9","3":"4"},{"1":"7","2":"face1","3":"8"},{"1":"7","2":"face2","3":"1"},{"1":"7","2":"face3","3":"1"},{"1":"7","2":"face4","3":"8"},{"1":"7","2":"face5","3":"3"},{"1":"7","2":"face6","3":"7"},{"1":"7","2":"face7","3":"7"},{"1":"7","2":"face8","3":"4"},{"1":"7","2":"face9","3":"2"},{"1":"8","2":"face1","3":"7"},{"1":"8","2":"face2","3":"6"},{"1":"8","2":"face3","3":"5"},{"1":"8","2":"face4","3":"9"},{"1":"8","2":"face5","3":"4"},{"1":"8","2":"face6","3":"3"},{"1":"8","2":"face7","3":"2"},{"1":"8","2":"face8","3":"9"},{"1":"8","2":"face9","3":"6"},{"1":"9","2":"face1","3":"6"},{"1":"9","2":"face2","3":"4"},{"1":"9","2":"face3","3":"9"},{"1":"9","2":"face4","3":"7"},{"1":"9","2":"face5","3":"7"},{"1":"9","2":"face6","3":"3"},{"1":"9","2":"face7","3":"4"},{"1":"9","2":"face8","3":"3"},{"1":"9","2":"face9","3":"6"},{"1":"10","2":"face1","3":"2"},{"1":"10","2":"face2","3":"4"},{"1":"10","2":"face3","3":"4"},{"1":"10","2":"face4","3":"9"},{"1":"10","2":"face5","3":"9"},{"1":"10","2":"face6","3":"3"},{"1":"10","2":"face7","3":"5"},{"1":"10","2":"face8","3":"3"},{"1":"10","2":"face9","3":"7"},{"1":"11","2":"face1","3":"1"},{"1":"11","2":"face2","3":"7"},{"1":"11","2":"face3","3":"1"},{"1":"11","2":"face4","3":"4"},{"1":"11","2":"face5","3":"4"},{"1":"11","2":"face6","3":"8"},{"1":"11","2":"face7","3":"1"},{"1":"11","2":"face8","3":"2"},{"1":"11","2":"face9","3":"2"},{"1":"12","2":"face1","3":"7"},{"1":"12","2":"face2","3":"8"},{"1":"12","2":"face3","3":"3"},{"1":"12","2":"face4","3":"8"},{"1":"12","2":"face5","3":"6"},{"1":"12","2":"face6","3":"7"},{"1":"12","2":"face7","3":"3"},{"1":"12","2":"face8","3":"7"},{"1":"12","2":"face9","3":"9"},{"1":"13","2":"face1","3":"1"},{"1":"13","2":"face2","3":"4"},{"1":"13","2":"face3","3":"4"},{"1":"13","2":"face4","3":"2"},{"1":"13","2":"face5","3":"4"},{"1":"13","2":"face6","3":"4"},{"1":"13","2":"face7","3":"6"},{"1":"13","2":"face8","3":"9"},{"1":"13","2":"face9","3":"3"},{"1":"14","2":"face1","3":"5"},{"1":"14","2":"face2","3":"1"},{"1":"14","2":"face3","3":"7"},{"1":"14","2":"face4","3":"1"},{"1":"14","2":"face5","3":"6"},{"1":"14","2":"face6","3":"1"},{"1":"14","2":"face7","3":"2"},{"1":"14","2":"face8","3":"5"},{"1":"14","2":"face9","3":"1"},{"1":"15","2":"face1","3":"9"},{"1":"15","2":"face2","3":"8"},{"1":"15","2":"face3","3":"9"},{"1":"15","2":"face4","3":"1"},{"1":"15","2":"face5","3":"9"},{"1":"15","2":"face6","3":"2"},{"1":"15","2":"face7","3":"8"},{"1":"15","2":"face8","3":"6"},{"1":"15","2":"face9","3":"4"},{"1":"16","2":"face1","3":"4"},{"1":"16","2":"face2","3":"8"},{"1":"16","2":"face3","3":"1"},{"1":"16","2":"face4","3":"4"},{"1":"16","2":"face5","3":"6"},{"1":"16","2":"face6","3":"6"},{"1":"16","2":"face7","3":"1"},{"1":"16","2":"face8","3":"1"},{"1":"16","2":"face9","3":"9"},{"1":"17","2":"face1","3":"8"},{"1":"17","2":"face2","3":"1"},{"1":"17","2":"face3","3":"5"},{"1":"17","2":"face4","3":"4"},{"1":"17","2":"face5","3":"2"},{"1":"17","2":"face6","3":"3"},{"1":"17","2":"face7","3":"3"},{"1":"17","2":"face8","3":"9"},{"1":"17","2":"face9","3":"5"},{"1":"18","2":"face1","3":"6"},{"1":"18","2":"face2","3":"5"},{"1":"18","2":"face3","3":"2"},{"1":"18","2":"face4","3":"6"},{"1":"18","2":"face5","3":"5"},{"1":"18","2":"face6","3":"3"},{"1":"18","2":"face7","3":"5"},{"1":"18","2":"face8","3":"2"},{"1":"18","2":"face9","3":"4"},{"1":"19","2":"face1","3":"6"},{"1":"19","2":"face2","3":"4"},{"1":"19","2":"face3","3":"7"},{"1":"19","2":"face4","3":"9"},{"1":"19","2":"face5","3":"5"},{"1":"19","2":"face6","3":"4"},{"1":"19","2":"face7","3":"8"},{"1":"19","2":"face8","3":"9"},{"1":"19","2":"face9","3":"7"},{"1":"20","2":"face1","3":"1"},{"1":"20","2":"face2","3":"1"},{"1":"20","2":"face3","3":"8"},{"1":"20","2":"face4","3":"1"},{"1":"20","2":"face5","3":"5"},{"1":"20","2":"face6","3":"5"},{"1":"20","2":"face7","3":"5"},{"1":"20","2":"face8","3":"5"},{"1":"20","2":"face9","3":"5"},{"1":"21","2":"face1","3":"3"},{"1":"21","2":"face2","3":"6"},{"1":"21","2":"face3","3":"6"},{"1":"21","2":"face4","3":"5"},{"1":"21","2":"face5","3":"5"},{"1":"21","2":"face6","3":"5"},{"1":"21","2":"face7","3":"1"},{"1":"21","2":"face8","3":"2"},{"1":"21","2":"face9","3":"7"},{"1":"22","2":"face1","3":"3"},{"1":"22","2":"face2","3":"7"},{"1":"22","2":"face3","3":"2"},{"1":"22","2":"face4","3":"1"},{"1":"22","2":"face5","3":"9"},{"1":"22","2":"face6","3":"4"},{"1":"22","2":"face7","3":"5"},{"1":"22","2":"face8","3":"8"},{"1":"22","2":"face9","3":"8"},{"1":"23","2":"face1","3":"1"},{"1":"23","2":"face2","3":"8"},{"1":"23","2":"face3","3":"6"},{"1":"23","2":"face4","3":"8"},{"1":"23","2":"face5","3":"4"},{"1":"23","2":"face6","3":"1"},{"1":"23","2":"face7","3":"8"},{"1":"23","2":"face8","3":"3"},{"1":"23","2":"face9","3":"9"},{"1":"24","2":"face1","3":"4"},{"1":"24","2":"face2","3":"4"},{"1":"24","2":"face3","3":"4"},{"1":"24","2":"face4","3":"5"},{"1":"24","2":"face5","3":"5"},{"1":"24","2":"face6","3":"2"},{"1":"24","2":"face7","3":"6"},{"1":"24","2":"face8","3":"4"},{"1":"24","2":"face9","3":"6"},{"1":"25","2":"face1","3":"9"},{"1":"25","2":"face2","3":"3"},{"1":"25","2":"face3","3":"6"},{"1":"25","2":"face4","3":"3"},{"1":"25","2":"face5","3":"9"},{"1":"25","2":"face6","3":"3"},{"1":"25","2":"face7","3":"2"},{"1":"25","2":"face8","3":"2"},{"1":"25","2":"face9","3":"2"},{"1":"26","2":"face1","3":"1"},{"1":"26","2":"face2","3":"4"},{"1":"26","2":"face3","3":"9"},{"1":"26","2":"face4","3":"4"},{"1":"26","2":"face5","3":"9"},{"1":"26","2":"face6","3":"4"},{"1":"26","2":"face7","3":"6"},{"1":"26","2":"face8","3":"8"},{"1":"26","2":"face9","3":"3"},{"1":"27","2":"face1","3":"5"},{"1":"27","2":"face2","3":"7"},{"1":"27","2":"face3","3":"1"},{"1":"27","2":"face4","3":"2"},{"1":"27","2":"face5","3":"1"},{"1":"27","2":"face6","3":"5"},{"1":"27","2":"face7","3":"1"},{"1":"27","2":"face8","3":"8"},{"1":"27","2":"face9","3":"9"},{"1":"28","2":"face1","3":"1"},{"1":"28","2":"face2","3":"5"},{"1":"28","2":"face3","3":"3"},{"1":"28","2":"face4","3":"3"},{"1":"28","2":"face5","3":"5"},{"1":"28","2":"face6","3":"7"},{"1":"28","2":"face7","3":"3"},{"1":"28","2":"face8","3":"1"},{"1":"28","2":"face9","3":"7"},{"1":"29","2":"face1","3":"4"},{"1":"29","2":"face2","3":"8"},{"1":"29","2":"face3","3":"1"},{"1":"29","2":"face4","3":"6"},{"1":"29","2":"face5","3":"6"},{"1":"29","2":"face6","3":"7"},{"1":"29","2":"face7","3":"9"},{"1":"29","2":"face8","3":"1"},{"1":"29","2":"face9","3":"8"},{"1":"30","2":"face1","3":"3"},{"1":"30","2":"face2","3":"3"},{"1":"30","2":"face3","3":"7"},{"1":"30","2":"face4","3":"8"},{"1":"30","2":"face5","3":"8"},{"1":"30","2":"face6","3":"5"},{"1":"30","2":"face7","3":"7"},{"1":"30","2":"face8","3":"5"},{"1":"30","2":"face9","3":"5"},{"1":"31","2":"face1","3":"5"},{"1":"31","2":"face2","3":"8"},{"1":"31","2":"face3","3":"2"},{"1":"31","2":"face4","3":"7"},{"1":"31","2":"face5","3":"2"},{"1":"31","2":"face6","3":"9"},{"1":"31","2":"face7","3":"3"},{"1":"31","2":"face8","3":"6"},{"1":"31","2":"face9","3":"4"},{"1":"32","2":"face1","3":"5"},{"1":"32","2":"face2","3":"3"},{"1":"32","2":"face3","3":"7"},{"1":"32","2":"face4","3":"4"},{"1":"32","2":"face5","3":"2"},{"1":"32","2":"face6","3":"4"},{"1":"32","2":"face7","3":"1"},{"1":"32","2":"face8","3":"2"},{"1":"32","2":"face9","3":"7"},{"1":"33","2":"face1","3":"9"},{"1":"33","2":"face2","3":"7"},{"1":"33","2":"face3","3":"4"},{"1":"33","2":"face4","3":"3"},{"1":"33","2":"face5","3":"5"},{"1":"33","2":"face6","3":"4"},{"1":"33","2":"face7","3":"3"},{"1":"33","2":"face8","3":"5"},{"1":"33","2":"face9","3":"3"},{"1":"34","2":"face1","3":"2"},{"1":"34","2":"face2","3":"3"},{"1":"34","2":"face3","3":"7"},{"1":"34","2":"face4","3":"2"},{"1":"34","2":"face5","3":"1"},{"1":"34","2":"face6","3":"8"},{"1":"34","2":"face7","3":"4"},{"1":"34","2":"face8","3":"2"},{"1":"34","2":"face9","3":"5"},{"1":"35","2":"face1","3":"7"},{"1":"35","2":"face2","3":"5"},{"1":"35","2":"face3","3":"3"},{"1":"35","2":"face4","3":"6"},{"1":"35","2":"face5","3":"7"},{"1":"35","2":"face6","3":"5"},{"1":"35","2":"face7","3":"2"},{"1":"35","2":"face8","3":"4"},{"1":"35","2":"face9","3":"5"},{"1":"36","2":"face1","3":"3"},{"1":"36","2":"face2","3":"4"},{"1":"36","2":"face3","3":"6"},{"1":"36","2":"face4","3":"5"},{"1":"36","2":"face5","3":"2"},{"1":"36","2":"face6","3":"9"},{"1":"36","2":"face7","3":"1"},{"1":"36","2":"face8","3":"2"},{"1":"36","2":"face9","3":"4"},{"1":"37","2":"face1","3":"2"},{"1":"37","2":"face2","3":"3"},{"1":"37","2":"face3","3":"2"},{"1":"37","2":"face4","3":"1"},{"1":"37","2":"face5","3":"5"},{"1":"37","2":"face6","3":"2"},{"1":"37","2":"face7","3":"2"},{"1":"37","2":"face8","3":"6"},{"1":"37","2":"face9","3":"2"},{"1":"38","2":"face1","3":"8"},{"1":"38","2":"face2","3":"7"},{"1":"38","2":"face3","3":"7"},{"1":"38","2":"face4","3":"7"},{"1":"38","2":"face5","3":"9"},{"1":"38","2":"face6","3":"5"},{"1":"38","2":"face7","3":"4"},{"1":"38","2":"face8","3":"5"},{"1":"38","2":"face9","3":"5"},{"1":"39","2":"face1","3":"8"},{"1":"39","2":"face2","3":"9"},{"1":"39","2":"face3","3":"9"},{"1":"39","2":"face4","3":"5"},{"1":"39","2":"face5","3":"2"},{"1":"39","2":"face6","3":"3"},{"1":"39","2":"face7","3":"1"},{"1":"39","2":"face8","3":"1"},{"1":"39","2":"face9","3":"5"},{"1":"40","2":"face1","3":"6"},{"1":"40","2":"face2","3":"2"},{"1":"40","2":"face3","3":"7"},{"1":"40","2":"face4","3":"3"},{"1":"40","2":"face5","3":"2"},{"1":"40","2":"face6","3":"5"},{"1":"40","2":"face7","3":"9"},{"1":"40","2":"face8","3":"2"},{"1":"40","2":"face9","3":"9"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>In the examples above, we would call the format of the first data.frame the “short-form”, while the format for the second is “long-form”. To convert a dataframe from short-form to long-form and vice versa, we use the <code>gather()</code> and <code>spread()</code> functions respectively.</p>
</div>
<div id="gather" class="section level3">
<h3>gather()</h3>
<p>The <code>gather()</code> function converts data.frames from short-form to long-form. In order to do this, we first need to specify two new variable names. First, the ‘key’, which could be considered as the name for your ‘Trial ID’ (in the example above, this is the different faces). Second, the ‘value’ variable, which is the name of the variable you are converting to long-form (in the example above, we have used ‘rating’). Finally, you need to specify all the variables that you are converting to long-form. So to covert the data.frame above, the code looks like this:</p>
<pre class="r"><code>data_long &lt;- gather(data_short,key = &quot;face&quot;,value = &quot;rating&quot;,face1,face2,face3,face4,face5,face6,face7,face8,face9) %&gt;%
  arrange(participant_ID,face)</code></pre>
</div>
<div id="spread" class="section level3">
<h3>spread()</h3>
<p>If you want to convert back the other way for some reason, you can use the <code>spread()</code> function. Again, you will need to specify which column is the ‘key’ and which column is the variable you wish to convert to short-form. With this information, the <code>spread()</code> function is smart enough to know what to do:</p>
<pre class="r"><code>data_short &lt;- spread(data_long,key = face,value = rating)</code></pre>
</div>
</div>
<div id="actually-preparing-the-data" class="section level2">
<h2>Actually preparing the data</h2>
<p>So, with all that information out of the way, let’s actually convert our future discounting data from short-form to long-form.</p>
<pre class="r"><code>data_long &lt;- gather(data_clean,key = &quot;kirby_id&quot;,value = &quot;response&quot;,kirby1,kirby2,kirby3,kirby4,kirby5,kirby6,kirby7,kirby8,kirby9) %&gt;%
  arrange(user_id,kirby_id)</code></pre>
</div>
<div id="run-the-analysis" class="section level2">
<h2>Run the analysis</h2>
<p>As always, now that we have the data.frame prepared for analysis, the only other thing we need is the formula. For the following analysis, we require three random effect groups:</p>
<ol style="list-style-type: decimal">
<li>A random effect of participant.</li>
<li>A random effect of country.</li>
<li>A random effect of trial.</li>
</ol>
<p>We also want to specify random slopes maximally, therefore, we will need a random slope of age for the country group, and the trial group. We do not need one for the participant group, because age does not vary within participants.</p>
<p>Altogether, our formula becomes:</p>
<pre class="r"><code>formula &lt;- &#39;response ~ z.age + 
  (1 | user_id) + 
  (1 + z.age  || resident) + 
  (1 + z.age || kirby_id)&#39;</code></pre>
<p>Note: we use the double <code>||</code> symbol above because a convergence error when using a single <code>|</code>.</p>
<p>We can now run the analysis! Note: given that our dependent variable is a dichotomous variable, we need to use the <code>glmer()</code> function, and specify that the response is binomail using the ‘family’ argument.</p>
<pre class="r"><code>model &lt;- glmer(formula,data = data_long,family = &quot;binomial&quot;)</code></pre>
<pre class="r"><code>summary(model)</code></pre>
<pre><code>## Generalized linear mixed model fit by maximum likelihood (Laplace
##   Approximation) [glmerMod]
##  Family: binomial  ( logit )
## Formula: response ~ z.age + (1 | user_id) + (1 + z.age || resident) +  
##     (1 + z.age || kirby_id)
##    Data: data_long
## 
##      AIC      BIC   logLik deviance df.resid 
##  76864.7  76932.5 -38425.3  76850.7   120188 
## 
## Scaled residuals: 
##     Min      1Q  Median      3Q     Max 
## -65.748  -0.250  -0.048   0.203  53.356 
## 
## Random effects:
##  Groups     Name        Variance  Std.Dev. 
##  user_id    (Intercept) 5.617e+00 2.370e+00
##  resident   (Intercept) 2.865e-01 5.352e-01
##  resident.1 z.age       3.076e-10 1.754e-05
##  kirby_id   (Intercept) 1.385e+01 3.721e+00
##  kirby_id.1 z.age       3.336e+00 1.827e+00
## Number of obs: 120195, groups:  user_id, 13355; resident, 55; kirby_id, 9
## 
## Fixed effects:
##             Estimate Std. Error z value Pr(&gt;|z|)  
## (Intercept)  -1.0518     1.2142  -0.866   0.3864  
## z.age         1.1077     0.6512   1.701   0.0889 .
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Correlation of Fixed Effects:
##       (Intr)
## z.age 0.009 
## convergence code: 0
## boundary (singular) fit: see ?isSingular</code></pre>
</div>
</div>
<div id="exercises-1" class="section level1">
<h1>Exercises</h1>
<p>Now that you’ve completed this week’s workbook, why not give this week’s exercises a go? You can download the interactive exercises by clicking the link below.</p>
<p><a href = "exercises.html">Click here to download this week’s exercises.</a></p>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
