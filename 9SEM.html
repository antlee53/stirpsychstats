<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>HPSP131 - Demonstration 9 - Path Analysis and Structural Equation Modelling</title>

<script src="site_libs/header-attrs-2.30/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/flatly.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.13.2/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>









<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark the anchor link active (and if it's in a dropdown, also mark that active)
  var dropdown = menuAnchor.closest('li.dropdown');
  if (window.bootstrap) { // Bootstrap 4+
    menuAnchor.addClass('active');
    dropdown.find('> .dropdown-toggle').addClass('active');
  } else { // Bootstrap 3
    menuAnchor.parent().addClass('active');
    dropdown.addClass('active');
  }

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before, .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "\e259";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "\e258";
  font-family: 'Glyphicons Halflings';
  border: none;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">HPSP131</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="1intro.html">1. Intro</a>
</li>
<li>
  <a href="2data.html">2. Data 1</a>
</li>
<li>
  <a href="7GLM.html">3. Data 2</a>
</li>
<li>
  <a href="3plot.html">4. Plot</a>
</li>
<li>
  <a href="4LM1.html">5. ttest_ANOVA</a>
</li>
<li>
  <a href="5LM2.html">6. Cor_Reg</a>
</li>
<li>
  <a href="6mod.html">7. Mod</a>
</li>
<li>
  <a href="8sim22.html">8. Pwr_Med</a>
</li>
<li>
  <a href="9SEM.html">9. SEM</a>
</li>
<li>
  <a href="10mixed.html">10. Mixed</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Extra
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="extra_chatGPT.html">Using ChatGPT to learn R</a>
    </li>
    <li>
      <a href="extra_lists.html">Lists, Matrices, and Indexing</a>
    </li>
    <li>
      <a href="extra_joins.html">Joining data.frames</a>
    </li>
    <li>
      <a href="extra_cleaning.html">Cleaning and Data Preparation</a>
    </li>
    <li>
      <a href="extra_chisquare.html">Chi-square Tests</a>
    </li>
    <li>
      <a href="extra_nonparametric.html">Non-parametric Tests</a>
    </li>
    <li>
      <a href="extra_logistic.html">Logistic Regression</a>
    </li>
    <li>
      <a href="extra_functions.html">Custom Functions</a>
    </li>
    <li>
      <a href="extra_simulation.html">Simulations</a>
    </li>
  </ul>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">HPSP131 - Demonstration 9 - Path Analysis
and Structural Equation Modelling</h1>

</div>


<div id="objectives" class="section level1">
<h1>Objectives</h1>
<p>The aim of this week is to introduce the <code>lavaan</code> package
for Structural Equation Modelling (e.g., path analysis) in R. By the end
of this demonstration, you should be familiar with:</p>
<ol style="list-style-type: decimal">
<li>The basics of the lavaan package.</li>
<li>Run a simple path analysis.</li>
<li>Run a simple confirmatory factor analysis.</li>
<li>Conduct model comparisons.</li>
</ol>
</div>
<div id="resources" class="section level1">
<h1>Resources</h1>
<p>Here is a list of resources that may help you with this weeks
content:</p>
<p><a href="http://lavaan.ugent.be/tutorial/">lavaan tutorial</a> <a
href="http://lavaan.ugent.be/tutorial/tutorial.pdf">lavaan tutorial
pdf</a></p>
</div>
<div id="class-data" class="section level1">
<h1>Class Data</h1>
<p><a href = files/data_2024.csv download>Click here to download the
data used in these demonstrations.</a> (You may need to right-click and
select â€˜Save Linked Fileâ€™ option)</p>
</div>
<div id="content" class="section level1">
<h1>Content</h1>
<p>We will be using the following packages in this weekâ€™s demonstration.
If youâ€™ve been following along with the demonstrations, this is the
first time weâ€™ve used the <code>lavaan</code> and <code>semPlot</code>
packages, so make sure to install these first before loading them. The
<code>lavaan</code> package includes functions that allow us to conduct
the analyses, while the <code>semPlot</code> package includes functions
that allows us to visualise path diagrams.</p>
<pre class="r"><code>library(lavaan)
library(tidyverse)
library(semPlot)</code></pre>
<div id="before-we-continue" class="section level2">
<h2>Before We Continueâ€¦</h2>
<p>We are about to start using the <code>lavaan</code> package, which is
used for path analyses and structural equation models. This
demonstration is only meant to serve as an introduction to the
<code>lavaan</code> package, and therefore we will only discuss some of
the basic functions. You are able to add a lot of complexity to
structural equation models that we will not be touching. If you truly
wish to master this package, you will need to go beyond the content
covered here.</p>
</div>
<div id="mediation-analysis-through-structural-equation-modelling-sem"
class="section level2">
<h2>Mediation Analysis Through Structural Equation Modelling (SEM)</h2>
<p>Mediation is an example of a simple SEM. We will first re-run the
mediation we conducted in Demonstration 8 in the <code>lavaan</code>
package, as this is a handy way of demonstrating the logic of the
<code>lavaan</code> package. As a reminder, we predict that the
association between exercise attitudes and exercise behaviour is
mediated by the intention to exercise.</p>
<p>As with all analyses, we will be following the basic procedure
of:</p>
<ol style="list-style-type: decimal">
<li>Clean the data for analysis.</li>
<li>Run the statistical test.</li>
<li>Plot the data.</li>
<li>Write-up analysis.</li>
</ol>
<div id="clean-the-data-for-analysis." class="section level3">
<h3>1. Clean the data for analysis.</h3>
<p>As always, our first step is to calculate the variables from the
individual items.</p>
<p>The code below is identical to the code used for the mediation in
Week 8 and used to calculate exercise attitude, intentions to exercise,
and exercise behaviour.</p>
<pre class="r"><code>data2.clean &lt;- data %&gt;%
  mutate(attitude = exercise.attitude.1 + exercise.attitude.2 + exercise.attitude.3 + exercise.attitude.4 + exercise.attitude.5,
         intention = exercise.intention.1 + exercise.intention.2 + exercise.intention.3 + exercise.intention.4 + exercise.intention.5,
         behaviour = exercise.behaviour.1 + exercise.behaviour.2 + exercise.behaviour.3 + exercise.behaviour.4 + exercise.behaviour.5) %&gt;%
  dplyr::select(student.no,attitude,intention,behaviour) %&gt;%
  drop_na(attitude) %&gt;%
  drop_na(intention) %&gt;%
  drop_na(behaviour)</code></pre>
</div>
<div id="run-statistical-test." class="section level3">
<h3>2. Run statistical test.</h3>
<p>Previously, when specifying a regression formula in R, we have used
the following form:</p>
<blockquote>
<p>y ~ x1 + x2 + x3 + â€¦</p>
</blockquote>
<p>An SEM formula is an extention of of this, where multiple regression
equations (or similar relationships) are estimated at once. Like with a
regression, we use the <code>~</code> to specify a relationship between
an outcome (on the left), and predictors (on the right).</p>
<p>In the table below are some other relationships that you may use when
constructing a SEM.</p>
<table>
<colgroup>
<col width="9%" />
<col width="18%" />
<col width="20%" />
<col width="52%" />
</colgroup>
<thead>
<tr class="header">
<th>operator</th>
<th>relationship type</th>
<th>example</th>
<th>explanation</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>=~</code></td>
<td>Latent Variable</td>
<td>y =~ x1 + x2 + x3â€¦</td>
<td>y is measured by x1, x2, x3, etc.</td>
</tr>
<tr class="even">
<td><code>~~</code></td>
<td>Covariance</td>
<td>x1 ~~ x2</td>
<td>x1 is correlated with x2</td>
</tr>
<tr class="odd">
<td><code>:=</code></td>
<td>Define Parameter</td>
<td>effect := a*b</td>
<td>Estimate â€˜effectâ€™ which is made up of â€˜aâ€™ times â€˜bâ€™</td>
</tr>
</tbody>
</table>
<p>Note: you can also label parameters by using the <code>*</code>
symbol before variables. If you give two variables the same label, it
will force the estimates to be the same (this comes in handy sometimes,
but not something we will use in this demonstration). Note: the label
you give cannot have the same name as a variable in the data.frame
(otherwise R will think you are referring to that variable and multiply
to two together!).</p>
<p>Below is the formula to conduct a mediation analysis identical to the
one we conducted in Demonstration 8. See if you can understand each line
and what relationship it is specifying before reading the breakdown.
Remember, each line of code can be read as relationships between
variables in the model.</p>
<pre class="r"><code>sem.formula &lt;- &#39;
behaviour ~ c*attitude
behaviour ~ b*intention
intention ~ a*attitude

indirect := a*b
direct := c
total := direct + indirect
&#39;</code></pre>
<p>Letâ€™s break this down:</p>
<table>
<colgroup>
<col width="25%" />
<col width="74%" />
</colgroup>
<thead>
<tr class="header">
<th>line</th>
<th>explanation</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>behaviour ~ c*attitude</td>
<td>Behaviour is predicted from attitude, and this relationship is
labelled â€˜câ€™</td>
</tr>
<tr class="even">
<td>behaviour ~ b*intention</td>
<td>Behaviour is predicted from intention, and this relationship is
labelled â€˜bâ€™</td>
</tr>
<tr class="odd">
<td>intention ~ a*attitude</td>
<td>Intention is predicted from attitude, and this relationship is
labelled â€˜aâ€™</td>
</tr>
<tr class="even">
<td>indirect := a*b</td>
<td>Define a parameter called â€˜indirectâ€™ which is made up of â€˜aâ€™ times
â€˜bâ€™</td>
</tr>
<tr class="odd">
<td>direct := c</td>
<td>Define a parameter called â€˜directâ€™ which is made up of â€˜câ€™</td>
</tr>
<tr class="even">
<td>total := direct + indirect</td>
<td>Define the total effect (the combination of direct and indirect
effect).</td>
</tr>
</tbody>
</table>
<p>Essentially, the first three lines of the code are identical to
running the <code>Model 1</code>, <code>Model 2</code>, and
<code>Model 3</code> that we ran when testing whether the conditions of
mediation were met, while the last three lines are like running the
<code>mediate()</code> function to get estimates for the indirect and
direct effect.</p>
<p>To run the SEM, we use the <code>sem()</code> function. Like all
analyses done previously, we need to specify two things: the formula
(which we saved as the object <code>sem.formula</code>) and the
data.frame. We also set values for a few other arguments. We set
â€˜standardizedâ€™ to <code>TRUE</code> so that we get standardised
estimates, â€˜fit.measuresâ€™ to <code>TRUE</code> so we get model fit
indicators, and â€˜rsquareâ€™ to <code>TRUE</code> to get an r-square
statistics for the model.</p>
<pre class="r"><code>med.sem.model &lt;- sem(sem.formula,data2.clean)</code></pre>
<pre class="r"><code>summary(med.sem.model,standardized = TRUE, fit.measures = TRUE, rsquare = TRUE)</code></pre>
<pre><code>## lavaan 0.6-19 ended normally after 1 iteration
## 
##   Estimator                                         ML
##   Optimization method                           NLMINB
##   Number of model parameters                         5
## 
##   Number of observations                            88
## 
## Model Test User Model:
##                                                       
##   Test statistic                                 0.000
##   Degrees of freedom                                 0
## 
## Model Test Baseline Model:
## 
##   Test statistic                                83.926
##   Degrees of freedom                                 3
##   P-value                                        0.000
## 
## User Model versus Baseline Model:
## 
##   Comparative Fit Index (CFI)                    1.000
##   Tucker-Lewis Index (TLI)                       1.000
## 
## Loglikelihood and Information Criteria:
## 
##   Loglikelihood user model (H0)               -570.526
##   Loglikelihood unrestricted model (H1)       -570.526
##                                                       
##   Akaike (AIC)                                1151.051
##   Bayesian (BIC)                              1163.438
##   Sample-size adjusted Bayesian (SABIC)       1147.660
## 
## Root Mean Square Error of Approximation:
## 
##   RMSEA                                          0.000
##   90 Percent confidence interval - lower         0.000
##   90 Percent confidence interval - upper         0.000
##   P-value H_0: RMSEA &lt;= 0.050                       NA
##   P-value H_0: RMSEA &gt;= 0.080                       NA
## 
## Standardized Root Mean Square Residual:
## 
##   SRMR                                           0.000
## 
## Parameter Estimates:
## 
##   Standard errors                             Standard
##   Information                                 Expected
##   Information saturated (h1) model          Structured
## 
## Regressions:
##                    Estimate  Std.Err  z-value  P(&gt;|z|)   Std.lv  Std.all
##   behaviour ~                                                           
##     attitude   (c)    0.075    0.124    0.606    0.544    0.075    0.104
##     intention  (b)   -0.047    0.116   -0.406    0.685   -0.047   -0.069
##   intention ~                                                           
##     attitude   (a)    0.831    0.070   11.807    0.000    0.831    0.783
## 
## Variances:
##                    Estimate  Std.Err  z-value  P(&gt;|z|)   Std.lv  Std.all
##    .behaviour        41.824    6.305    6.633    0.000   41.824    0.996
##    .intention        35.068    5.287    6.633    0.000   35.068    0.387
## 
## R-Square:
##                    Estimate
##     behaviour         0.004
##     intention         0.613
## 
## Defined Parameters:
##                    Estimate  Std.Err  z-value  P(&gt;|z|)   Std.lv  Std.all
##     indirect         -0.039    0.097   -0.406    0.685   -0.039   -0.054
##     direct            0.075    0.124    0.606    0.544    0.075    0.104
##     total             0.036    0.077    0.464    0.643    0.036    0.049</code></pre>
<p>If we compare the results here to mediation, we should see that we
get very similar, if not the same, results.</p>
</div>
<div id="plot-the-model." class="section level3">
<h3>3. Plot the model.</h3>
<p>The easiest way to plot a structural equation model is using a path
diagram. Unfortunately, this is not easy to do in <code>ggplot2</code>.
However, we can use the <code>semPaths()</code> function from the
<code>semPlot</code> package. This function has the advantage of being
easy to use - all you need to do is load your model estimated in laavan
and specify which paths you want to see (or hide). The disadvantage is
that editing the layout or customising the look of your path diagram can
be difficult. Therefore, in order to create publication worthy graphics,
you may want to recreate the diagram in another program.</p>
<pre class="r"><code>semPaths(med.sem.model,whatLabel = &quot;std&quot;,intercept = FALSE,residuals = FALSE)</code></pre>
<p><img src="9SEM_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
</div>
</div>
<div id="more-complicated-path-analysis" class="section level2">
<h2>More complicated Path Analysis</h2>
<p>We will now have a go at conducting a more complicated SEM. We will
continue investigating the relationship between attitudes to exercise,
intentions to exercise, and exercise behaviour, but also now investigate
norms surrounding fitness and perceived behavioural control. The model
we will fit is based on the Theory of Planned Behaviour, and is depicted
below.</p>
<div class="float">
<img src="images/TPB.png" alt="Theory of Planned Behaviour" />
<div class="figcaption">Theory of Planned Behaviour</div>
</div>
<p>In words, we predict that attitudes towards exercise, norms about
exercise, and perceived behavioural control regarding exercise will
predict intention to exercise. In turn, intention to exercise predicts
exercise behaviour. We also predict that perceived behavioural control
regarding exercise will directly predict exercise behaviour.</p>
<div id="clean-the-data-for-analysis.-1" class="section level3">
<h3>1. Clean the data for analysis.</h3>
<p>First, we must calculate the variables from each of the items.
Something we have done many times now.</p>
<pre class="r"><code>data2.clean &lt;- data %&gt;%
  mutate(attitude = exercise.attitude.1 + exercise.attitude.2 + exercise.attitude.3 + exercise.attitude.4 + exercise.attitude.5,
         intention = exercise.intention.1 + exercise.intention.2 + exercise.intention.3 + exercise.intention.4 + exercise.intention.5,
         control = exercise.control.1 + exercise.control.2 + exercise.control.3,
         norms = exercise.norms.1 + exercise.norms.2 + exercise.norms.3 + exercise.norms.4 + exercise.norms.5,
         behaviour = exercise.behaviour.1 + exercise.behaviour.2 + exercise.behaviour.3 + exercise.behaviour.4 + exercise.behaviour.5) %&gt;%
  dplyr::select(student.no,attitude,intention,control,norms,behaviour) %&gt;%
  drop_na(attitude) %&gt;%
  drop_na(intention) %&gt;%
  drop_na(control) %&gt;%
  drop_na(norms) %&gt;%
  drop_na(behaviour)</code></pre>
</div>
<div id="run-statistical-test.-1" class="section level3">
<h3>2. Run statistical test.</h3>
<p>First, we need to specify the model. Below, this model is specified
as formula that <code>lavaan</code> can read:</p>
<pre class="r"><code>model &lt;- &#39;
intention ~ attitude + norms + control

norms ~~ attitude
attitude ~~ control
control ~~ norms

behaviour ~ intention + control
&#39;</code></pre>
<p>To break down the code above: Line 1: Attitudes, norms, and control
predict intention. Lines 2 to 4: Covariance between predictors is
specified explicitly. Line 5: Intention, control and attitudes predicts
behaviour.</p>
<p>We then run the SEM model using the <code>sem()</code> function:</p>
<pre class="r"><code>sem.model &lt;- sem(model,data = data2.clean)</code></pre>
<pre class="r"><code>summary(sem.model,standardized = TRUE,fit = TRUE, rsquare = TRUE)</code></pre>
<pre><code>## lavaan 0.6-19 ended normally after 56 iterations
## 
##   Estimator                                         ML
##   Optimization method                           NLMINB
##   Number of model parameters                        14
## 
##   Number of observations                            88
## 
## Model Test User Model:
##                                                       
##   Test statistic                                 3.406
##   Degrees of freedom                                 1
##   P-value (Chi-square)                           0.065
## 
## Model Test Baseline Model:
## 
##   Test statistic                               197.836
##   Degrees of freedom                                10
##   P-value                                        0.000
## 
## User Model versus Baseline Model:
## 
##   Comparative Fit Index (CFI)                    0.987
##   Tucker-Lewis Index (TLI)                       0.872
## 
## Loglikelihood and Information Criteria:
## 
##   Loglikelihood user model (H0)              -1402.655
##   Loglikelihood unrestricted model (H1)      -1400.952
##                                                       
##   Akaike (AIC)                                2833.310
##   Bayesian (BIC)                              2867.993
##   Sample-size adjusted Bayesian (SABIC)       2823.815
## 
## Root Mean Square Error of Approximation:
## 
##   RMSEA                                          0.165
##   90 Percent confidence interval - lower         0.000
##   90 Percent confidence interval - upper         0.372
##   P-value H_0: RMSEA &lt;= 0.050                    0.095
##   P-value H_0: RMSEA &gt;= 0.080                    0.859
## 
## Standardized Root Mean Square Residual:
## 
##   SRMR                                           0.027
## 
## Parameter Estimates:
## 
##   Standard errors                             Standard
##   Information                                 Expected
##   Information saturated (h1) model          Structured
## 
## Regressions:
##                    Estimate  Std.Err  z-value  P(&gt;|z|)   Std.lv  Std.all
##   intention ~                                                           
##     attitude          0.483    0.068    7.096    0.000    0.483    0.455
##     norms             0.464    0.057    8.083    0.000    0.464    0.524
##     control           0.001    0.137    0.010    0.992    0.001    0.001
##   behaviour ~                                                           
##     intention        -0.093    0.108   -0.859    0.390   -0.093   -0.136
##     control           0.720    0.182    3.967    0.000    0.720    0.391
##     attitude          0.098    0.114    0.863    0.388    0.098    0.136
## 
## Covariances:
##                    Estimate  Std.Err  z-value  P(&gt;|z|)   Std.lv  Std.all
##   attitude ~~                                                           
##     norms            60.247   12.113    4.974    0.000   60.247    0.625
##     control           1.598    3.370    0.474    0.635    1.598    0.051
##   norms ~~                                                              
##     control           5.923    4.085    1.450    0.147    5.923    0.156
## 
## Variances:
##                    Estimate  Std.Err  z-value  P(&gt;|z|)   Std.lv  Std.all
##    .intention        19.899    3.000    6.633    0.000   19.899    0.220
##    .behaviour        35.478    5.349    6.633    0.000   35.478    0.845
##     attitude         80.349   12.113    6.633    0.000   80.349    1.000
##     norms           115.512   17.414    6.633    0.000  115.512    1.000
##     control          12.409    1.871    6.633    0.000   12.409    1.000
## 
## R-Square:
##                    Estimate
##     intention         0.780
##     behaviour         0.155</code></pre>
<p>Notice above in the <code>summary()</code> function, we have included
the additional arguments to get extra statistics that are helpful when
it comes to report the analysis.</p>
</div>
<div id="plot-the-model.-1" class="section level3">
<h3>3. Plot the model.</h3>
<p>Again, we use <code>semPaths()</code> to plot our SEM model. Here,
the limitations of not being able to easily organise the layout of your
plot is apparent, though it still may be helpful to visualise your
results to help your understanding.</p>
<pre class="r"><code>semPaths(sem.model,whatLabel = &quot;std&quot;,intercept = FALSE,residuals = FALSE)</code></pre>
<p><img src="9SEM_files/figure-html/unnamed-chunk-14-1.png" width="672" /></p>
</div>
</div>
<div id="model-comparisons" class="section level2">
<h2>Model Comparisons</h2>
<p>Model comparisons can be used to help decide which model best
explains your data with the fewest number of parameters. As covered in
the lecture series, models can only be compared if they are nested
(i.e., one model must be contained within the other model). For SEM,
using model comparisons is particularly useful to determine the
significance of individuals paths.</p>
<p>In the example below, we will compare the model above with a simpler
model, where the path between control and behaviour is removed. The
formula and code to conducted this slightly simpler model is as
follows:</p>
<pre class="r"><code>model2 &lt;- &#39;
intention ~ attitude + norms + control

norms ~~ attitude
attitude ~~ control
control ~~ norms

behaviour ~ intention
&#39;

sem.model2 &lt;- sem(model2,data = data2.clean)

#summary(sem.model2,standardized = TRUE,fit = TRUE, rsquare = TRUE)</code></pre>
<p>Note: we have not run the <code>summary()</code> function above to
save on space, but feel free to have a look at it.</p>
<p>Now that we have our two models that we will compare, the function we
use is called <code>anova()</code>, not to be confused with
<code>aov()</code> that runs ANOVA analyses.</p>
<p>For the <code>anova()</code> function, we simply have to specify the
two models we are comparing as the two arguments. This will conduct a
chi-square difference test.</p>
<pre class="r"><code>anova(sem.model,sem.model2)</code></pre>
<pre><code>## 
## Chi-Squared Difference Test
## 
##            Df    AIC    BIC   Chisq Chisq diff   RMSEA Df diff Pr(&gt;Chisq)    
## sem.model   1 2833.3 2868.0  3.4057                                          
## sem.model2  3 2844.2 2873.9 18.2521     14.846 0.27017       2  0.0005972 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>Above, we find that there is a significant difference between the two
models. Therefore, we can conclude that dropping the path between
â€˜controlâ€™ and â€˜behaviourâ€™ significantly reduces model fit. As such, we
should retain this path in the model.</p>
<p>While above, we use the <code>anova()</code> function to test the
difference between nested SEM models, we can also use this function to
compare models from other functions, such as <code>lm()</code>.</p>
</div>
<div id="introducing-latent-variables" class="section level2">
<h2>Introducing Latent Variables</h2>
<p>Up to now, to calculate variables from individual items, we have been
adding each item up. However, we could also compute latent variables,
which are the underlying variables that each item is meant to tap into.
Essentially, this is conducting a Confirmatory Factor Analysis.</p>
<p>For example, we could calculate the latent variable â€˜normsâ€™ from each
of the individual items.</p>
<pre class="r"><code>attitude.formula &lt;- &#39;
  attitude =~ exercise.attitude.1 + exercise.attitude.2 + exercise.attitude.3 + exercise.attitude.4 + exercise.attitude.5
&#39;

attitude.model &lt;- sem(attitude.formula,data = data)</code></pre>
<pre class="r"><code>summary(attitude.model,standardized = TRUE)</code></pre>
<pre><code>## lavaan 0.6-19 ended normally after 23 iterations
## 
##   Estimator                                         ML
##   Optimization method                           NLMINB
##   Number of model parameters                        10
## 
##   Number of observations                            88
## 
## Model Test User Model:
##                                                       
##   Test statistic                                 3.696
##   Degrees of freedom                                 5
##   P-value (Chi-square)                           0.594
## 
## Parameter Estimates:
## 
##   Standard errors                             Standard
##   Information                                 Expected
##   Information saturated (h1) model          Structured
## 
## Latent Variables:
##                    Estimate  Std.Err  z-value  P(&gt;|z|)   Std.lv  Std.all
##   attitude =~                                                           
##     exercis.tttd.1    1.000                               1.646    0.937
##     exercis.tttd.2    1.179    0.081   14.479    0.000    1.940    0.895
##     exercis.tttd.3    0.910    0.134    6.793    0.000    1.498    0.611
##     exercis.tttd.4    1.080    0.061   17.610    0.000    1.778    0.951
##     exercis.tttd.5    1.043    0.093   11.221    0.000    1.717    0.812
## 
## Variances:
##                    Estimate  Std.Err  z-value  P(&gt;|z|)   Std.lv  Std.all
##    .exercis.tttd.1    0.380    0.087    4.356    0.000    0.380    0.123
##    .exercis.tttd.2    0.933    0.172    5.409    0.000    0.933    0.199
##    .exercis.tttd.3    3.760    0.582    6.461    0.000    3.760    0.626
##    .exercis.tttd.4    0.336    0.091    3.711    0.000    0.336    0.096
##    .exercis.tttd.5    1.524    0.251    6.064    0.000    1.524    0.341
##     attitude          2.709    0.467    5.804    0.000    1.000    1.000</code></pre>
<pre class="r"><code>semPaths(attitude.model,whatLabel = &quot;std&quot;,intercept = FALSE,residuals = FALSE)</code></pre>
<p><img src="9SEM_files/figure-html/unnamed-chunk-22-1.png" width="672" /></p>
<p>How about we compute latent variables for all the variables in the
TPB model above? Doing something like this may not make a lot of sense:
we will end up with a gangly model, and we may not have enough
observations to get sensible results, but we can do it do it anyway! For
demonstrative purposes of courseâ€¦ The code is provided below to run this
analysis, but this code is not executed, as the output is quite long an
unweildy.</p>
<div id="specify-the-model" class="section level3">
<h3>Specify the Model</h3>
<pre class="r"><code>model &lt;- &#39;
  attitude =~ exercise.attitude.1 + exercise.attitude.2 + exercise.attitude.3 + exercise.attitude.4 + exercise.attitude.5
  intention =~ exercise.intention.1 + exercise.intention.2 + exercise.intention.3 + exercise.intention.4 + exercise.intention.5
  control =~ exercise.control.1 + exercise.control.2 + exercise.control.3
  norms =~ exercise.norms.1 + exercise.norms.2 + exercise.norms.3 + exercise.norms.4 + exercise.norms.5
  behaviour =~ exercise.behaviour.1 + exercise.behaviour.2 + exercise.behaviour.3 + exercise.behaviour.4 + exercise.behaviour.5

  intention ~ attitude + norms + control
  behaviour ~ intention + control
&#39;</code></pre>
<p>We wonâ€™t run the <code>summary()</code> just now because it is very
unwieldy, but we have covered the interpretation of the output
above.</p>
<pre class="r"><code>sem.model3 &lt;- sem(model,data = data)
summary(sem.model3,standardized = TRUE,fit = TRUE, rsquare = TRUE)</code></pre>
</div>
</div>
</div>
<div id="plot-the-model" class="section level1">
<h1>Plot the Model</h1>
<p>Again, we can plot the SEM using <code>semPaths()</code>, but this
gets pretty messy, given the number of items make up each latent
variable.</p>
<pre class="r"><code>semPaths(sem.model3,whatLabel = &quot;std&quot;,intercept = FALSE,residuals = FALSE)</code></pre>
<p><img src="9SEM_files/figure-html/unnamed-chunk-26-1.png" width="672" /></p>
</div>
<div id="exercises" class="section level1">
<h1>Exercises</h1>
<p>Now that youâ€™ve completed this weekâ€™s demonstration, why not give
this weekâ€™s exercises a go? For students on HPSP131, you can access the
interactive exercises through the HPSP131 Canvas page.</p>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
